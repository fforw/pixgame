var Game=function(e){function t(t){for(var n,a,s=t[0],u=t[1],f=t[2],l=0,c=[];l<s.length;l++)a=s[l],i[a]&&c.push(i[a][0]),i[a]=0;for(n in u)Object.prototype.hasOwnProperty.call(u,n)&&(e[n]=u[n]);for(h&&h(t);c.length;)c.shift()();return o.push.apply(o,f||[]),r()}function r(){for(var e,t=0;t<o.length;t++){for(var r=o[t],n=!0,s=1;s<r.length;s++){var u=r[s];0!==i[u]&&(n=!1)}n&&(o.splice(t--,1),e=a(a.s=r[0]))}return e}var n={},i={1:0},o=[];function a(t){if(n[t])return n[t].exports;var r=n[t]={i:t,l:!1,exports:{}};return e[t].call(r.exports,r,r.exports,a),r.l=!0,r.exports}a.m=e,a.c=n,a.d=function(e,t,r){a.o(e,t)||Object.defineProperty(e,t,{enumerable:!0,get:r})},a.r=function(e){"undefined"!=typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(e,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(e,"__esModule",{value:!0})},a.t=function(e,t){if(1&t&&(e=a(e)),8&t)return e;if(4&t&&"object"==typeof e&&e&&e.__esModule)return e;var r=Object.create(null);if(a.r(r),Object.defineProperty(r,"default",{enumerable:!0,value:e}),2&t&&"string"!=typeof e)for(var n in e)a.d(r,n,function(t){return e[t]}.bind(null,n));return r},a.n=function(e){var t=e&&e.__esModule?function(){return e.default}:function(){return e};return a.d(t,"a",t),t},a.o=function(e,t){return Object.prototype.hasOwnProperty.call(e,t)},a.p="";var s=window.webpackJsonpGame=window.webpackJsonpGame||[],u=s.push.bind(s);s.push=t,s=s.slice();for(var f=0;f<s.length;f++)t(s[f]);var h=u;return o.push([30,0]),r()}({3:function(e,t,r){},30:function(e,t,r){"use strict";r.r(t);r(3),r(4);var n=r(6),i=r.n(n),o=r(16);function a(e,t){for(var r=0;r<t.length;r++){var n=t[r];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,n.key,n)}}function s(e,t){var r=Object.keys(e);return Object.getOwnPropertySymbols&&r.push.apply(r,Object.getOwnPropertySymbols(e)),t&&(r=r.filter(function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable})),r}function u(e){for(var t=1;t<arguments.length;t++){var r=null!=arguments[t]?arguments[t]:{};t%2?s(r,!0).forEach(function(t){f(e,t,r[t])}):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(r)):s(r).forEach(function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(r,t))})}return e}function f(e,t,r){return t in e?Object.defineProperty(e,t,{value:r,enumerable:!0,configurable:!0,writable:!0}):e[t]=r,e}var h=2*Math.PI,l=1.4,c=20,d=5;function p(e){return e<-1?-1:e>1?1:e}var v=.05,m=.07,x=.09,b=.5,y=0,g=1,T=2,w=3,C=4,S=5,M=6,A=7;function z(e,t){for(var r=new k(e,t),n=0,i=r.data,o=0;o<e;o++)for(var a=0;a<e;a++){var s=r.heightCoords(a,o),u=r.heightFn(a,o,s);if(u<v)i[n++]=y;else if(u<m)i[n++]=g;else if(u<b){var f=s.nx,h=s.ny,l=s.nz,p=s.nw,A=u>x?r.noise4D(f*d,p*d,h*d,l*d):1,z=r.noise4D(f*c,p*c,h*c,l*c);i[n++]=A<.12?z<0?S:M:z<0?T:w}else i[n++]=C}return r}var _=[0,-1,-1,0,1,0,0,1];function P(e,t){for(var r=t.value,n=t.x,i=t.y,o=e.size,a=!1,s=0;s<_.length;s+=2){var u=t.x+_[s],f=t.y+_[s+1];if(u>0&&f>0&&u<o&&f<o){var h=e.heightFn(u,f);h>r&&(r=h,n=u,i=f,a=!0)}}return!!a&&{x:n,y:i,value:r,length:0}}function B(e){var t=function(e){var t=[],r=e.size,n=r*r/1e3;console.log("Probe count =",n);for(var i=0;i<n;i++){var o=e.random.next()*r|0,a=e.random.next()*r|0,s=e.heightFn(o,a);s>v&&t.push({x:o,y:a,value:s,length:0,tile:0})}return t}(e);console.log(t.length,"random probes");var r=e.size,n=t.length,i=0,o=0;for(o=0;o<r/2&&i<n;o++)for(var a=i;a<n;a++){var s=P(e,t[a]);if(s)t[a]=s;else{var f=t[i];t[i]=t[a],t[a]=f,i++}}console.log("Stopped climbing after ",o," iterations");var h=function(e){for(var t=e.length,r=[],n=0;n<t;n++){for(var i=e[n],o=!0,a=t-1;a>n;a--){var s=e[a];if(i.x===s.x&&i.y===s.y){o=!1;break}}o&&r.push(i)}return r}(t);return console.log(h.length,"springs"),function(e,t){for(var r=arguments.length>2&&void 0!==arguments[2]?arguments[2]:4,n=2*r,i=[],o=0;o<t.length;o++){var a=t[o];a.x=a.x-r+e.random.next()*n|0,a.y=a.y-r+e.random.next()*n|0,e.heightFn(a.x,a.y)>b&&e.random.next()<.6&&i.push(u({},a,{x:a.x-r+e.random.next()*n|0,y:a.y-r+e.random.next()*n|0}))}return t.concat(i)}(e,h)}function I(e,t){for(var r=1/0,n=t.x,i=t.y,o=-1,a=!1,s=e.size,u=0;u<_.length;u+=2){var f=t.x+_[u],h=t.y+_[u+1];if(f>0&&h>0&&f<s&&h<s){var l=e.read(f,h);if(l!==A){if(l===C){var d=e.heightCoords(f,h),p=d.nx,v=d.ny,m=d.nz,x=d.nw;l=e.noise4D(p*c,x*c,v*c,m*c)<0?T:w}var b=e.heightFn(f,h)-(l!==g&&t.tile===l?.01:0);b<r&&(r=b,n=f,i=h,u,o=l,a=!0)}}}if(t.length++,a)t.x=n,t.y=i,t.value=r,t.tile=o;else{var y=2*(4*e.random.next()|0);t.x+=_[y],t.y+=_[y+1],t.tile=e.read(t.x,t.y)}}function R(e,t,r){var n=e.read(t,r);n!==y&&n!==A&&e.write(t,r,A)}function O(e){var t=B(e),r=e.size,n=t.length,i=0,o=0;for(o=0;o<r&&i<n;o++)for(var a=i;a<n;a++){var s=t[a],u=s.x,f=s.y;R(e,u,f),I(e,s);var h=0|Math.min(5,.05*s.length);if(h>1&&R(e,u-1,f),h>2&&R(e,u+1,f),h>3&&R(e,u,f-1),h>4&&R(e,u,f+1),e.read(s.x,s.y)===y){var l=t[i];t[i]=t[a],t[a]=l,i++}}console.log("Stopped flowing after ",o," iterations")}var k=function(){function e(){var t=this,r=arguments.length>0&&void 0!==arguments[0]?arguments[0]:800,n=arguments.length>1?arguments[1]:void 0;!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,e),console.log("New map "+r+" x "+r+", seed = "+n),this.random=new o.a(n),this.noise=new i.a(function(){return t.random.next()}),this.size=r,this.factor=1/r,this.data=new Uint8Array(r*r)}var t,r,n;return t=e,n=[{key:"generate",value:function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:(new Date).getTime(),r=z(e,t);return O(r),r}}],(r=[{key:"read",value:function(e,t){return this.data[t*this.size+e]}},{key:"write",value:function(e,t,r){this.data[t*this.size+e]=r}},{key:"heightFn",value:function(e,t){var r,n,i,o,a=arguments.length>2&&void 0!==arguments[2]?arguments[2]:null,s=e*this.factor,u=t*this.factor;a?(r=a.nx,n=a.ny,i=a.nz,o=a.nw):(r=Math.cos(s*h),n=Math.cos(u*h),i=Math.sin(s*h),o=Math.sin(u*h));var f=this.noise4D(.4*r,.4*n,.4*i,.4*o),c=this.noise4D(r*l,o*l,n*l,i*l);return p(f<0?-f*f:f*f)+.3*c}},{key:"heightCoords",value:function(e,t){var r=e*this.factor,n=t*this.factor;return{nx:Math.cos(r*h),ny:Math.cos(n*h),nz:Math.sin(r*h),nw:Math.sin(n*h)}}},{key:"render",value:function(e){for(var t=this.size,r=e.createImageData(t,t),n=0,i=r.data,o=0;o<t;o++)for(var a=0;a<t;a++){switch(this.read(a,o)){case A:case y:i[n++]=0,i[n++]=32,i[n++]=128,i[n++]=255;break;case g:i[n++]=192,i[n++]=160,i[n++]=0,i[n++]=255;break;case T:i[n++]=0,i[n++]=128,i[n++]=0,i[n++]=255;break;case S:i[n++]=0,i[n++]=96,i[n++]=0,i[n++]=128;break;case M:i[n++]=0,i[n++]=64,i[n++]=0,i[n++]=144;break;case w:i[n++]=64,i[n++]=64,i[n++]=0,i[n++]=255;break;case C:i[n++]=160,i[n++]=160,i[n++]=160,i[n++]=255}}return r}},{key:"noise4D",value:function(e,t,r,n){return this.noise.noise4D(e,t,r,n)}}])&&a(t.prototype,r),n&&a(t,n),e}();window.onload=function(){var e=document.querySelector("div.loading");e.parentNode.removeChild(e);var t=document.createElement("canvas");t.width=1024,t.height=1024,document.getElementById("root").appendChild(t);var r=t.getContext("2d"),n=k.generate(1024,"floppy-disk").render(r);r.putImageData(n,0,0),console.log("ready")}},4:function(e,t,r){(function(e){!function(t){var r=function(e){this.tileAnim=[0,0],this.dontUseTransform=!1,this.renderer=e,this.tileAnim=[0,0]};t.CanvasTileRenderer=r;var n=e.CanvasRenderer;n&&n.registerPlugin("tilemap",r)}(r||(r={}));var t,r,n=this&&this.__extends||(t=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var r in t)t.hasOwnProperty(r)&&(e[r]=t[r])},function(e,r){function n(){this.constructor=e}t(e,r),e.prototype=null===r?Object.create(r):(n.prototype=r.prototype,new n)});!function(t){var r=function(r){function i(e,t,n){var i=r.call(this)||this;return i.modificationMarker=0,i.shadowColor=new Float32Array([0,0,0,.5]),i._globalMat=null,i.initialize.apply(i,arguments),i}return n(i,r),i.prototype.updateTransform=function(){this.displayObjectUpdateTransform()},i.prototype.initialize=function(e,r,n){!0===n&&(n=0),this.z=this.zIndex=e,this.texPerChild=n||t.Constant.boundCountPerBuffer*t.Constant.maxTextures,r&&this.setBitmaps(r)},i.prototype.setBitmaps=function(e){var r,n=this.texPerChild,i=this.children.length,o=Math.ceil(e.length/n);for(r=0;r<i;r++)this.children[r].textures=e.slice(r*n,(r+1)*n);for(r=i;r<o;r++){var a=new t.RectTileLayer(this.zIndex,e.slice(r*n,(r+1)*n));a.compositeParent=!0,a.offsetX=t.Constant.boundSize,a.offsetY=t.Constant.boundSize,this.addChild(a)}},i.prototype.clear=function(){for(var e=0;e<this.children.length;e++)this.children[e].clear();this.modificationMarker=0},i.prototype.addRect=function(e,t,r,n,i,o,a){var s=e/this.texPerChild>>0,u=e%this.texPerChild;this.children[s]&&this.children[s].textures&&this.children[s].addRect(u,t,r,n,i,o,a)},i.prototype.addFrame=function(r,n,i,o,a){var s,u=null,f=0,h=this.children;if("number"==typeof r){if(u=h[r/this.texPerChild>>0])f=r%this.texPerChild;else{if(!(u=h[0]))return!1;f=0}s=u.textures[f]}else{s="string"==typeof r?e.Texture.from(r):r;for(var l=0;l<h.length;l++){for(var c=(p=h[l]).textures,d=0;d<c.length;d++)if(c[d].baseTexture===s.baseTexture){u=p,f=d;break}if(u)break}if(!u){for(l=0;l<h.length;l++){var p;if((p=h[l]).textures.length<this.texPerChild){u=p,f=p.textures.length,p.textures.push(s);break}}u||((u=new t.RectTileLayer(this.zIndex,s)).compositeParent=!0,u.offsetX=t.Constant.boundSize,u.offsetY=t.Constant.boundSize,h.push(u),f=0)}}return u.addRect(f,s.frame.x,s.frame.y,n,i,s.frame.width,s.frame.height,o,a),!0},i.prototype.renderCanvas=function(e){if(this.visible&&!(this.worldAlpha<=0)&&this.renderable){if(!e.plugins.tilemap.dontUseTransform){var t=this.worldTransform;e.context.setTransform(t.a,t.b,t.c,t.d,t.tx*e.resolution,t.ty*e.resolution)}for(var r=this.children,n=0;n<r.length;n++)r[n].renderCanvasCore(e)}},i.prototype.render=function(e){if(this.visible&&!(this.worldAlpha<=0)&&this.renderable){var t=e.plugins.tilemap,r=t.getShader();e.batch.setObjectRenderer(t),this._globalMat=r.uniforms.projTransMatrix,e.globalUniforms.uniforms.projectionMatrix.copyTo(this._globalMat).append(this.worldTransform),r.uniforms.shadowColor=this.shadowColor,r.uniforms.animationFrame=t.tileAnim,e.shader.bind(r,!1);for(var n=this.children,i=0;i<n.length;i++)n[i].renderWebGLCore(e,t)}},i.prototype.isModified=function(e){var t=this.children;if(this.modificationMarker!==t.length)return!0;for(var r=0;r<t.length;r++)if(t[r].isModified(e))return!0;return!1},i.prototype.clearModify=function(){var e=this.children;this.modificationMarker=e.length;for(var t=0;t<e.length;t++)e[t].clearModify()},i}(e.Container);t.CompositeRectTileLayer=r}(r||(r={})),function(t){t.Constant={maxTextures:4,bufferSize:2048,boundSize:1024,boundCountPerBuffer:1,use32bitIndex:!1,SCALE_MODE:e.SCALE_MODES.LINEAR,DO_CLEAR:!0}}(r||(r={})),r||(r={}),function(t){function r(e){var r=t.call(this)||this;return r.zIndex=e,r}n(r,t),r.prototype.renderCanvas=function(t){var r=null;t.plugins.tilemap.dontUseTransform&&(r=this.transform.worldTransform,this.transform.worldTransform=e.Matrix.IDENTITY),t.plugins.graphics.render(this),t.plugins.tilemap.dontUseTransform&&(this.transform.worldTransform=r),t.context.globalAlpha=1},r.prototype.isModified=function(e){return!1},r.prototype.clearModify=function(){}}(e.Graphics),function(t){var r=function(r){function i(t){var n=r.call(this,t.bufferSize,t.bufferSize)||this;n.DO_CLEAR=!1,n.boundSize=0,n._clearBuffer=null,n.baseTex=null,n.boundSprites=[],n.dirties=[];var i=n.boundSprites,o=n.dirties;n.boundSize=t.boundSize;for(var a=0;a<t.boundCountPerBuffer;a++){var s=new e.Sprite;s.position.x=t.boundSize*(1&a),s.position.y=t.boundSize*(a>>1),i.push(s),o.push(0)}return n.DO_CLEAR=!!t.DO_CLEAR,n}return n(i,r),i.prototype.bind=function(e){if(this.baseTex)throw new Error("Only one baseTexture is allowed for this resource!");this.baseTex=e,r.prototype.bind.call(this,e)},i.prototype.setTexture=function(e,t){var r=this.boundSprites[e];r.texture.baseTexture!==t.baseTexture&&(r.texture=t,this.baseTex.update(),this.dirties[e]=this.baseTex.dirtyId)},i.prototype.upload=function(e,r,n){var i=e.gl,o=this.width,a=this.height;i.pixelStorei(i.UNPACK_PREMULTIPLY_ALPHA_WEBGL,r.premultiplyAlpha),n.dirtyId<0&&(n.width=o,n.height=a,i.texImage2D(r.target,0,r.format,o,a,0,r.format,r.type,null));var s=this.DO_CLEAR;s&&!this._clearBuffer&&(this._clearBuffer=new Uint8Array(t.Constant.boundSize*t.Constant.boundSize*4));for(var u=this.boundSprites,f=0;f<u.length;f++){var h=u[f],l=h.texture.baseTexture;if(!(n.dirtyId>=this.dirties[f])){var c=l.resource;l.valid&&c&&c.source&&(s&&(l.width<this.boundSize||l.height<this.boundSize)&&i.texSubImage2D(r.target,0,h.position.x,h.position.y,this.boundSize,this.boundSize,r.format,r.type,this._clearBuffer),i.texSubImage2D(r.target,0,h.position.x,h.position.y,r.format,r.type,c.source))}}return!0},i}(e.resources.Resource);t.MultiTextureResource=r}(r||(r={})),function(t){var r=function(r){function i(e,t){var n=r.call(this)||this;return n.zIndex=0,n.modificationMarker=0,n.shadowColor=new Float32Array([0,0,0,.5]),n._globalMat=null,n.pointsBuf=[],n.hasAnim=!1,n.offsetX=0,n.offsetY=0,n.compositeParent=!1,n.vbId=0,n.vb=null,n.vbBuffer=null,n.vbArray=null,n.vbInts=null,n.initialize(e,t),n}return n(i,r),i.prototype.initialize=function(e,t){t?t instanceof Array||!t.baseTexture||(t=[t]):t=[],this.textures=t,this.zIndex=e},i.prototype.clear=function(){this.pointsBuf.length=0,this.modificationMarker=0,this.hasAnim=!1},i.prototype.addFrame=function(t,r,n,i,o){var a,s=0;if("number"==typeof t)s=t,a=this.textures[s];else{a="string"==typeof t?e.Texture.from(t):t;for(var u=!1,f=this.textures,h=0;h<f.length;h++)if(f[h].baseTexture===a.baseTexture){s=h,u=!0;break}if(!u)return!1}return this.addRect(s,a.frame.x,a.frame.y,r,n,a.frame.width,a.frame.height,i,o),!0},i.prototype.addRect=function(e,t,r,n,i,o,a,s,u){void 0===s&&(s=0),void 0===u&&(u=0);var f=this.pointsBuf;if(this.hasAnim=this.hasAnim||s>0||u>0,o===a)f.push(t),f.push(r),f.push(n),f.push(i),f.push(o),f.push(a),f.push(0|s),f.push(0|u),f.push(e);else{var h=void 0;if(o%a==0)for(h=0;h<o/a;h++)f.push(t+h*a),f.push(r),f.push(n+h*a),f.push(i),f.push(a),f.push(a),f.push(0|s),f.push(0|u),f.push(e);else if(a%o==0)for(h=0;h<a/o;h++)f.push(t),f.push(r+h*o),f.push(n),f.push(i+h*o),f.push(o),f.push(o),f.push(0|s),f.push(0|u),f.push(e);else f.push(t),f.push(r),f.push(n),f.push(i),f.push(o),f.push(a),f.push(0|s),f.push(0|u),f.push(e)}},i.prototype.renderCanvas=function(e){if(!e.plugins.tilemap.dontUseTransform){var t=this.worldTransform;e.context.setTransform(t.a,t.b,t.c,t.d,t.tx*e.resolution,t.ty*e.resolution)}this.renderCanvasCore(e)},i.prototype.renderCanvasCore=function(e){if(0!==this.textures.length){var t=this.pointsBuf;e.context.fillStyle="#000000";for(var r=0,n=t.length;r<n;r+=9){var i=t[r],o=t[r+1],a=t[r+2],s=t[r+3],u=t[r+4],f=t[r+5];i+=t[r+6]*e.plugins.tilemap.tileAnim[0],o+=t[r+7]*e.plugins.tilemap.tileAnim[1];var h=t[r+8];h>=0?e.context.drawImage(this.textures[h].baseTexture.source,i,o,u,f,a,s,u,f):(e.context.globalAlpha=.5,e.context.fillRect(a,s,u,f),e.context.globalAlpha=1)}}},i.prototype.destroyVb=function(){this.vb&&(this.vb.destroy(),this.vb=null)},i.prototype.render=function(e){var t=e.plugins.tilemap,r=t.getShader();e.batch.setObjectRenderer(t),this._globalMat=r.uniforms.projTransMatrix,e.globalUniforms.uniforms.projectionMatrix.copyTo(this._globalMat).append(this.worldTransform),r.uniforms.shadowColor=this.shadowColor,r.uniforms.animationFrame=t.tileAnim,e.shader.bind(r,!1),this.renderWebGLCore(e,t)},i.prototype.renderWebGLCore=function(r,n){var i=this.pointsBuf;if(0!==i.length){var o=i.length/9,a=n.getShader(),s=this.textures;if(0!==s.length){n.bindTextures(r,a,s);var u=this.vb;u||(u=n.createVb(),this.vb=u,this.vbId=u.id,this.vbBuffer=null,this.modificationMarker=0),n.checkIndexBuffer(o,u);var f=t.Constant.boundCountPerBuffer,h=u.getBuffer("aVertexPosition"),l=o*u.vertPerQuad;if(0!==l){if(this.modificationMarker!==l){this.modificationMarker=l;var c=u.stride*l;if(!this.vbBuffer||this.vbBuffer.byteLength<c){for(var d=u.stride;d<c;)d*=2;this.vbBuffer=new ArrayBuffer(d),this.vbArray=new Float32Array(this.vbBuffer),this.vbInts=new Uint32Array(this.vbBuffer),h.update(this.vbBuffer)}for(var p=this.vbArray,v=(this.vbInts,0),m=0,x=this.offsetX,b=this.offsetY,y=0;y<i.length;y+=9){this.compositeParent&&(f>1?(m=i[y+8]>>2,x=this.offsetX*(1&i[y+8]),b=this.offsetY*(i[y+8]>>1&1)):(m=i[y+8],x=0,b=0));var g=i[y+2],T=i[y+3],w=i[y+4],C=i[y+5],S=i[y]+x,M=i[y+1]+b,A=i[y+6],z=i[y+7];p[v++]=g,p[v++]=T,p[v++]=S,p[v++]=M,p[v++]=S+.5,p[v++]=M+.5,p[v++]=S+w-.5,p[v++]=M+C-.5,p[v++]=A,p[v++]=z,p[v++]=m,p[v++]=g+w,p[v++]=T,p[v++]=S+w,p[v++]=M,p[v++]=S+.5,p[v++]=M+.5,p[v++]=S+w-.5,p[v++]=M+C-.5,p[v++]=A,p[v++]=z,p[v++]=m,p[v++]=g+w,p[v++]=T+C,p[v++]=S+w,p[v++]=M+C,p[v++]=S+.5,p[v++]=M+.5,p[v++]=S+w-.5,p[v++]=M+C-.5,p[v++]=A,p[v++]=z,p[v++]=m,p[v++]=g,p[v++]=T+C,p[v++]=S,p[v++]=M+C,p[v++]=S+.5,p[v++]=M+.5,p[v++]=S+w-.5,p[v++]=M+C-.5,p[v++]=A,p[v++]=z,p[v++]=m}h.update(p)}r.geometry.bind(u,a),r.geometry.draw(e.DRAW_MODES.TRIANGLES,6*o,0)}}}},i.prototype.isModified=function(e){return!!(this.modificationMarker!==this.pointsBuf.length||e&&this.hasAnim)},i.prototype.clearModify=function(){this.modificationMarker=this.pointsBuf.length},i.prototype.destroy=function(e){r.prototype.destroy.call(this,e),this.destroyVb()},i}(e.Container);t.RectTileLayer=r}(r||(r={})),function(t){var r="\nvarying vec2 vTextureCoord;\nvarying vec4 vFrame;\nvarying float vTextureId;\nuniform vec4 shadowColor;\nuniform sampler2D uSamplers[%count%];\nuniform vec2 uSamplerSize[%count%];\n\nvoid main(void){\n   vec2 textureCoord = clamp(vTextureCoord, vFrame.xy, vFrame.zw);\n   float textureId = floor(vTextureId + 0.5);\n\n   vec4 color;\n   %forloop%\n   gl_FragColor = color;\n}\n",i="\nattribute vec2 aVertexPosition;\nattribute vec2 aTextureCoord;\nattribute vec4 aFrame;\nattribute vec2 aAnim;\nattribute float aTextureId;\n\nuniform mat3 projTransMatrix;\nuniform vec2 animationFrame;\n\nvarying vec2 vTextureCoord;\nvarying float vTextureId;\nvarying vec4 vFrame;\n\nvoid main(void){\n   gl_Position = vec4((projTransMatrix * vec3(aVertexPosition, 1.0)).xy, 0.0, 1.0);\n   vec2 anim = aAnim * animationFrame;\n   vTextureCoord = aTextureCoord + anim;\n   vFrame = aFrame + vec4(anim, anim);\n   vTextureId = aTextureId;\n}\n",o=function(r){function i(n,i,o){var a=r.call(this,new e.Program(i,o),{animationFrame:new Float32Array(2),uSamplers:[],uSamplerSize:[],projTransMatrix:new e.Matrix})||this;return a.maxTextures=0,a.maxTextures=n,t.shaderGenerator.fillSamplers(a,a.maxTextures),a}return n(i,r),i}(e.Shader);t.TilemapShader=o;var a=function(e){function o(n){var o=e.call(this,n,i,t.shaderGenerator.generateFragmentSrc(n,r))||this;return t.shaderGenerator.fillSamplers(o,o.maxTextures),o}return n(o,e),o}(o);t.RectTileShader=a;var s=function(t){function r(){var r=t.call(this)||this;r.vertSize=11,r.vertPerQuad=4,r.stride=4*r.vertSize,r.lastTimeAccess=0;var n=r.buf=new e.Buffer(new Float32Array(2),!0,!1);return r.addAttribute("aVertexPosition",n,0,!1,0,r.stride,0).addAttribute("aTextureCoord",n,0,!1,0,r.stride,8).addAttribute("aFrame",n,0,!1,0,r.stride,16).addAttribute("aAnim",n,0,!1,0,r.stride,32).addAttribute("aTextureId",n,0,!1,0,r.stride,40),r}return n(r,t),r}(e.Geometry);t.RectTileGeom=s}(r||(r={})),function(t){var r=function(r){function i(n){var i=r.call(this,n)||this;return i.sn=-1,i.indexBuffer=null,i.ibLen=0,i.tileAnim=[0,0],i.texLoc=[],i.texResources=[],i.rectShader=new t.RectTileShader(t.Constant.maxTextures),i.indexBuffer=new e.Buffer(void 0,!0,!0),i.checkIndexBuffer(2e3),i.initBounds(),i}return n(i,r),i.prototype.initBounds=function(){if(!(t.Constant.boundCountPerBuffer<=1))for(var r=t.Constant.maxTextures,n=0;n<r;n++){var i=new t.MultiTextureResource(t.Constant),o=new e.BaseTexture(i);o.scaleMode=t.Constant.SCALE_MODE,o.wrapMode=e.WRAP_MODES.CLAMP,this.texResources.push(i)}},i.prototype.bindTexturesWithoutRT=function(e,t,r){var n=t.uniforms.uSamplerSize;this.texLoc.length=0;for(var i=0;i<r.length;i++){var o=r[i];if(!o||!o.valid)return;e.texture.bind(r[i],i),n[2*i]=1/r[i].baseTexture.width,n[2*i+1]=1/r[i].baseTexture.height}t.uniforms.uSamplerSize=n},i.prototype.bindTextures=function(e,r,n){var i=n.length,o=t.Constant.maxTextures;if(!(i>t.Constant.boundCountPerBuffer*o))if(t.Constant.boundCountPerBuffer<=1)this.bindTexturesWithoutRT(e,r,n);else{for(var a=0;a<i;a++){var s=n[a];if(s&&s.valid)this.texResources[a>>2].setTexture(3&a,s)}var u=a+3>>2;for(a=0;a<u;a++)e.texture.bind(this.texResources[a].baseTex,a)}},i.prototype.start=function(){},i.prototype.createVb=function(){var e=new t.RectTileGeom;return e.addIndex(this.indexBuffer),e.lastTimeAccess=Date.now(),e},i.prototype.checkIndexBuffer=function(r,n){void 0===n&&(n=null);var i=6*r;if(!(i<=this.ibLen)){for(var o=i;o<i;)o<<=1;this.ibLen=i,this.indexBuffer.update(e.utils.createIndicesForQuads(r,t.Constant.use32bitIndex))}},i.prototype.getShader=function(){return this.rectShader},i.prototype.destroy=function(){r.prototype.destroy.call(this),this.rectShader=null},i}(e.ObjectRenderer);t.TileRenderer=r,e.Renderer.registerPlugin("tilemap",r)}(r||(r={})),function(t){var r=function(t){function r(e,r){var n=t.call(this)||this;return n._lastAnimationFrame=-1,n.tilemap=e,n.z=r,n}return n(r,t),r.prototype.clear=function(){for(var e=this.children,t=0;t<e.length;t++)e[t].clear();this._previousLayers=0},r.prototype.cacheIfDirty=function(){var t=this.tilemap,r=this.children,n=this._previousLayers!==r.length;this._previousLayers=r.length;var i,o=this.canvasBuffer,a=this._tempRender;if(o||(o=this.canvasBuffer=document.createElement("canvas"),(a=this._tempRender=new e.CanvasRenderer(100,100,{view:o})).context=a.rootContext,a.plugins.tilemap.dontUseTransform=!0),o.width===t._layerWidth&&o.height===t._layerHeight||(o.width=t._layerWidth,o.height=t._layerHeight,n=!0),!n)for(i=0;i<r.length;i++)if(r[i].isModified(this._lastAnimationFrame!==t.animationFrame)){n=!0;break}if(this._lastAnimationFrame=t.animationFrame,n)for(t._hackRenderer&&t._hackRenderer(a),a.context.clearRect(0,0,o.width,o.height),i=0;i<r.length;i++)r[i].clearModify(),r[i].renderCanvas(a);for(this.layerTransform=this.worldTransform,i=0;i<r.length;i++){this.layerTransform=r[i].worldTransform;break}},r.prototype.renderCanvas=function(e){this.cacheIfDirty();var t=this.layerTransform;e.context.setTransform(t.a,t.b,t.c,t.d,t.tx*e.resolution,t.ty*e.resolution);this.tilemap;e.context.drawImage(this.canvasBuffer,0,0)},r}(e.Container);t.ZLayer=r}(r||(r={})),function(t){e.tilemap=t}(r||(r={})),function(e){!function(t){t.fillSamplers=function(t,r){for(var n=[],i=0;i<r;i++)n[i]=i;t.uniforms.uSamplers=n;var o=[];for(i=0;i<r;i++)o.push(1/e.Constant.bufferSize),o.push(1/e.Constant.bufferSize);t.uniforms.uSamplerSize=o},t.generateFragmentSrc=function(e,t){return t.replace(/%count%/gi,e+"").replace(/%forloop%/gi,this.generateSampleSrc(e))},t.generateSampleSrc=function(e){var t="";t+="\n",t+="\n",t+="if(vTextureId <= -1.0) {",t+="\n\tcolor = shadowColor;",t+="\n}";for(var r=0;r<e;r++)t+="\nelse ",r<e-1&&(t+="if(textureId == "+r+".0)"),t+="\n{",t+="\n\tcolor = texture2D(uSamplers["+r+"], textureCoord * uSamplerSize["+r+"]);",t+="\n}";return t+="\n",t+="\n"}}(e.shaderGenerator||(e.shaderGenerator={}))}(r||(r={}))}).call(this,r(1))}});
//# sourceMappingURL=bundle-height-d0910d3220362ba1f9e2.js.map