var Game=function(e){function t(t){for(var n,a,s=t[0],u=t[1],l=t[2],h=0,c=[];h<s.length;h++)a=s[h],i[a]&&c.push(i[a][0]),i[a]=0;for(n in u)Object.prototype.hasOwnProperty.call(u,n)&&(e[n]=u[n]);for(f&&f(t);c.length;)c.shift()();return o.push.apply(o,l||[]),r()}function r(){for(var e,t=0;t<o.length;t++){for(var r=o[t],n=!0,s=1;s<r.length;s++){var u=r[s];0!==i[u]&&(n=!1)}n&&(o.splice(t--,1),e=a(a.s=r[0]))}return e}var n={},i={3:0},o=[];function a(t){if(n[t])return n[t].exports;var r=n[t]={i:t,l:!1,exports:{}};return e[t].call(r.exports,r,r.exports,a),r.l=!0,r.exports}a.m=e,a.c=n,a.d=function(e,t,r){a.o(e,t)||Object.defineProperty(e,t,{enumerable:!0,get:r})},a.r=function(e){"undefined"!=typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(e,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(e,"__esModule",{value:!0})},a.t=function(e,t){if(1&t&&(e=a(e)),8&t)return e;if(4&t&&"object"==typeof e&&e&&e.__esModule)return e;var r=Object.create(null);if(a.r(r),Object.defineProperty(r,"default",{enumerable:!0,value:e}),2&t&&"string"!=typeof e)for(var n in e)a.d(r,n,function(t){return e[t]}.bind(null,n));return r},a.n=function(e){var t=e&&e.__esModule?function(){return e.default}:function(){return e};return a.d(t,"a",t),t},a.o=function(e,t){return Object.prototype.hasOwnProperty.call(e,t)},a.p="";var s=window.webpackJsonpGame=window.webpackJsonpGame||[],u=s.push.bind(s);s.push=t,s=s.slice();for(var l=0;l<s.length;l++)t(s[l]);var f=u;return o.push([37,0]),r()}({1:function(e,t,r){"use strict";var n=r(8),i=r.n(n),o=r(5),a=r(0),s=r.n(a);function u(e,t,r,n){var i,o=e.size,a=e.tiles,s=e.things;switch(n){case 0:case 1:s[(r-1)*o+t-1]=N,s[(r-1)*o+t]=N,s[(r-1)*o+t+1]=N,s[r*o+t-1]=N,a[i=r*o+t]!==A&&(a[i]=L,s[i]=N),s[r*o+t+1]=N,s[(r+1)*o+t-1]=N,s[(r+1)*o+t]=N,s[(r+1)*o+t+1]=N;break;case 2:s[(r-1)*o+t-1]=N,s[(r-1)*o+t]=N,s[(r-1)*o+t+1]=N,s[(r-1)*o+t+2]=N,s[r*o+t-1]=N,a[i=r*o+t]!==A&&(a[i]=L,s[i]=N),a[i=r*o+t+1]!==A&&(a[i]=L,s[i]=N),s[r*o+t+2]=N,s[(r+1)*o+t-1]=N,s[(r+1)*o+t]=N,s[(r+1)*o+t+1]=N,s[(r+1)*o+t+2]=N;break;case 3:s[(r-3)*o+t]=N,s[(r-3)*o+t+1]=N,s[(r-2)*o+t-1]=N,s[(r-2)*o+t]=N,s[(r-2)*o+t+1]=N,s[(r-2)*o+t+2]=N,s[(r-1)*o+t-2]=N,s[(r-1)*o+t-1]=N,a[i=(r-1)*o+t]!==A&&(a[i]=L,s[i]=N),a[i=(r-1)*o+t+1]!==A&&(a[i]=L,s[i]=N),s[(r-1)*o+t+2]=N,s[(r-1)*o+t+3]=N,s[r*o+t-2]=N,s[r*o+t-1]=N,a[i=r*o+t]!==A&&(a[i]=L,s[i]=N),a[i=r*o+t+1]!==A&&(a[i]=L,s[i]=N),s[r*o+t+2]=N,s[r*o+t+3]=N,s[(r+1)*o+t-1]=N,s[(r+1)*o+t]=N,s[(r+1)*o+t+1]=N,s[(r+1)*o+t+2]=N,s[(r+2)*o+t]=N,s[(r+2)*o+t+1]=N;break;case 4:s[(r-3)*o+t-1]=N,s[(r-3)*o+t]=N,s[(r-3)*o+t+1]=N,s[(r-2)*o+t-2]=N,s[(r-2)*o+t-1]=N,s[(r-2)*o+t]=N,s[(r-2)*o+t+1]=N,s[(r-2)*o+t+2]=N,s[(r-1)*o+t-3]=N,s[(r-1)*o+t-2]=N,a[i=(r-1)*o+t-1]!==A&&(a[i]=L,s[i]=N),a[i=(r-1)*o+t]!==A&&(a[i]=L,s[i]=N),a[i=(r-1)*o+t+1]!==A&&(a[i]=L,s[i]=N),s[(r-1)*o+t+2]=N,s[(r-1)*o+t+3]=N,s[r*o+t-3]=N,s[r*o+t-2]=N,a[i=r*o+t-1]!==A&&(a[i]=L,s[i]=N),a[i=r*o+t]!==A&&(a[i]=L,s[i]=N),a[i=r*o+t+1]!==A&&(a[i]=L,s[i]=N),s[r*o+t+2]=N,s[r*o+t+3]=N,s[(r+1)*o+t-2]=N,s[(r+1)*o+t-1]=N,s[(r+1)*o+t]=N,s[(r+1)*o+t+1]=N,s[(r+1)*o+t+2]=N,s[(r+2)*o+t-1]=N,s[(r+2)*o+t]=N,s[(r+2)*o+t+1]=N;break;case 5:s[(r-3)*o+t-1]=N,s[(r-3)*o+t]=N,s[(r-3)*o+t+1]=N,s[(r-2)*o+t-2]=N,s[(r-2)*o+t-1]=N,s[(r-2)*o+t]=N,s[(r-2)*o+t+1]=N,s[(r-2)*o+t+2]=N,s[(r-1)*o+t-3]=N,s[(r-1)*o+t-2]=N,a[i=(r-1)*o+t-1]!==A&&(a[i]=L,s[i]=N),a[i=(r-1)*o+t]!==A&&(a[i]=L,s[i]=N),a[i=(r-1)*o+t+1]!==A&&(a[i]=L,s[i]=N),s[(r-1)*o+t+2]=N,s[(r-1)*o+t+3]=N,s[r*o+t-3]=N,s[r*o+t-2]=N,a[i=r*o+t-1]!==A&&(a[i]=L,s[i]=N),a[i=r*o+t]!==A&&(a[i]=L,s[i]=N),a[i=r*o+t+1]!==A&&(a[i]=L,s[i]=N),s[r*o+t+2]=N,s[r*o+t+3]=N,s[(r+1)*o+t-3]=N,s[(r+1)*o+t-2]=N,a[i=(r+1)*o+t-1]!==A&&(a[i]=L,s[i]=N),a[i=(r+1)*o+t]!==A&&(a[i]=L,s[i]=N),a[i=(r+1)*o+t+1]!==A&&(a[i]=L,s[i]=N),s[(r+1)*o+t+2]=N,s[(r+1)*o+t+3]=N,s[(r+2)*o+t-2]=N,s[(r+2)*o+t-1]=N,s[(r+2)*o+t]=N,s[(r+2)*o+t+1]=N,s[(r+2)*o+t+2]=N,s[(r+3)*o+t-1]=N,s[(r+3)*o+t]=N,s[(r+3)*o+t+1]=N;break;case 6:s[(r-4)*o+t-1]=N,s[(r-4)*o+t]=N,s[(r-4)*o+t+1]=N,s[(r-3)*o+t-2]=N,s[(r-3)*o+t-1]=N,s[(r-3)*o+t]=N,s[(r-3)*o+t+1]=N,s[(r-3)*o+t+2]=N,s[(r-2)*o+t-3]=N,s[(r-2)*o+t-2]=N,a[i=(r-2)*o+t-1]!==A&&(a[i]=L,s[i]=N),a[i=(r-2)*o+t]!==A&&(a[i]=L,s[i]=N),a[i=(r-2)*o+t+1]!==A&&(a[i]=L,s[i]=N),s[(r-2)*o+t+2]=N,s[(r-2)*o+t+3]=N,s[(r-1)*o+t-4]=N,s[(r-1)*o+t-3]=N,a[i=(r-1)*o+t-2]!==A&&(a[i]=L,s[i]=N),a[i=(r-1)*o+t-1]!==A&&(a[i]=L,s[i]=N),a[i=(r-1)*o+t]!==A&&(a[i]=L,s[i]=N),a[i=(r-1)*o+t+1]!==A&&(a[i]=L,s[i]=N),a[i=(r-1)*o+t+2]!==A&&(a[i]=L,s[i]=N),s[(r-1)*o+t+3]=N,s[(r-1)*o+t+4]=N,s[r*o+t-4]=N,s[r*o+t-3]=N,a[i=r*o+t-2]!==A&&(a[i]=L,s[i]=N),a[i=r*o+t-1]!==A&&(a[i]=L,s[i]=N),a[i=r*o+t]!==A&&(a[i]=L,s[i]=N),a[i=r*o+t+1]!==A&&(a[i]=L,s[i]=N),a[i=r*o+t+2]!==A&&(a[i]=L,s[i]=N),s[r*o+t+3]=N,s[r*o+t+4]=N,s[(r+1)*o+t-4]=N,s[(r+1)*o+t-3]=N,a[i=(r+1)*o+t-2]!==A&&(a[i]=L,s[i]=N),a[i=(r+1)*o+t-1]!==A&&(a[i]=L,s[i]=N),a[i=(r+1)*o+t]!==A&&(a[i]=L,s[i]=N),a[i=(r+1)*o+t+1]!==A&&(a[i]=L,s[i]=N),a[i=(r+1)*o+t+2]!==A&&(a[i]=L,s[i]=N),s[(r+1)*o+t+3]=N,s[(r+1)*o+t+4]=N,s[(r+2)*o+t-3]=N,s[(r+2)*o+t-2]=N,a[i=(r+2)*o+t-1]!==A&&(a[i]=L,s[i]=N),a[i=(r+2)*o+t]!==A&&(a[i]=L,s[i]=N),a[i=(r+2)*o+t+1]!==A&&(a[i]=L,s[i]=N),s[(r+2)*o+t+2]=N,s[(r+2)*o+t+3]=N,s[(r+3)*o+t-2]=N,s[(r+3)*o+t-1]=N,s[(r+3)*o+t]=N,s[(r+3)*o+t+1]=N,s[(r+3)*o+t+2]=N,s[(r+4)*o+t-1]=N,s[(r+4)*o+t]=N,s[(r+4)*o+t+1]=N;break;case 7:s[(r-5)*o+t-1]=N,s[(r-5)*o+t]=N,s[(r-5)*o+t+1]=N,s[(r-4)*o+t-2]=N,s[(r-4)*o+t-1]=N,s[(r-4)*o+t]=N,s[(r-4)*o+t+1]=N,s[(r-4)*o+t+2]=N,s[(r-3)*o+t-3]=N,s[(r-3)*o+t-2]=N,a[i=(r-3)*o+t-1]!==A&&(a[i]=L,s[i]=N),a[i=(r-3)*o+t]!==A&&(a[i]=L,s[i]=N),a[i=(r-3)*o+t+1]!==A&&(a[i]=L,s[i]=N),s[(r-3)*o+t+2]=N,s[(r-3)*o+t+3]=N,s[(r-2)*o+t-4]=N,s[(r-2)*o+t-3]=N,a[i=(r-2)*o+t-2]!==A&&(a[i]=L,s[i]=N),a[i=(r-2)*o+t-1]!==A&&(a[i]=L,s[i]=N),a[i=(r-2)*o+t]!==A&&(a[i]=L,s[i]=N),a[i=(r-2)*o+t+1]!==A&&(a[i]=L,s[i]=N),a[i=(r-2)*o+t+2]!==A&&(a[i]=L,s[i]=N),s[(r-2)*o+t+3]=N,s[(r-2)*o+t+4]=N,s[(r-1)*o+t-5]=N,s[(r-1)*o+t-4]=N,a[i=(r-1)*o+t-3]!==A&&(a[i]=L,s[i]=N),a[i=(r-1)*o+t-2]!==A&&(a[i]=L,s[i]=N),a[i=(r-1)*o+t-1]!==A&&(a[i]=L,s[i]=N),a[i=(r-1)*o+t]!==A&&(a[i]=L,s[i]=N),a[i=(r-1)*o+t+1]!==A&&(a[i]=L,s[i]=N),a[i=(r-1)*o+t+2]!==A&&(a[i]=L,s[i]=N),a[i=(r-1)*o+t+3]!==A&&(a[i]=L,s[i]=N),s[(r-1)*o+t+4]=N,s[(r-1)*o+t+5]=N,s[r*o+t-5]=N,s[r*o+t-4]=N,a[i=r*o+t-3]!==A&&(a[i]=L,s[i]=N),a[i=r*o+t-2]!==A&&(a[i]=L,s[i]=N),a[i=r*o+t-1]!==A&&(a[i]=L,s[i]=N),a[i=r*o+t]!==A&&(a[i]=L,s[i]=N),a[i=r*o+t+1]!==A&&(a[i]=L,s[i]=N),a[i=r*o+t+2]!==A&&(a[i]=L,s[i]=N),a[i=r*o+t+3]!==A&&(a[i]=L,s[i]=N),s[r*o+t+4]=N,s[r*o+t+5]=N,s[(r+1)*o+t-5]=N,s[(r+1)*o+t-4]=N,a[i=(r+1)*o+t-3]!==A&&(a[i]=L,s[i]=N),a[i=(r+1)*o+t-2]!==A&&(a[i]=L,s[i]=N),a[i=(r+1)*o+t-1]!==A&&(a[i]=L,s[i]=N),a[i=(r+1)*o+t]!==A&&(a[i]=L,s[i]=N),a[i=(r+1)*o+t+1]!==A&&(a[i]=L,s[i]=N),a[i=(r+1)*o+t+2]!==A&&(a[i]=L,s[i]=N),a[i=(r+1)*o+t+3]!==A&&(a[i]=L,s[i]=N),s[(r+1)*o+t+4]=N,s[(r+1)*o+t+5]=N,s[(r+2)*o+t-4]=N,s[(r+2)*o+t-3]=N,a[i=(r+2)*o+t-2]!==A&&(a[i]=L,s[i]=N),a[i=(r+2)*o+t-1]!==A&&(a[i]=L,s[i]=N),a[i=(r+2)*o+t]!==A&&(a[i]=L,s[i]=N),a[i=(r+2)*o+t+1]!==A&&(a[i]=L,s[i]=N),a[i=(r+2)*o+t+2]!==A&&(a[i]=L,s[i]=N),s[(r+2)*o+t+3]=N,s[(r+2)*o+t+4]=N,s[(r+3)*o+t-3]=N,s[(r+3)*o+t-2]=N,a[i=(r+3)*o+t-1]!==A&&(a[i]=L,s[i]=N),a[i=(r+3)*o+t]!==A&&(a[i]=L,s[i]=N),a[i=(r+3)*o+t+1]!==A&&(a[i]=L,s[i]=N),s[(r+3)*o+t+2]=N,s[(r+3)*o+t+3]=N,s[(r+4)*o+t-2]=N,s[(r+4)*o+t-1]=N,s[(r+4)*o+t]=N,s[(r+4)*o+t+1]=N,s[(r+4)*o+t+2]=N,s[(r+5)*o+t-1]=N,s[(r+5)*o+t]=N,s[(r+5)*o+t+1]=N;break;case 8:s[(r-6)*o+t-1]=N,s[(r-6)*o+t]=N,s[(r-6)*o+t+1]=N,s[(r-5)*o+t-3]=N,s[(r-5)*o+t-2]=N,s[(r-5)*o+t-1]=N,s[(r-5)*o+t]=N,s[(r-5)*o+t+1]=N,s[(r-5)*o+t+2]=N,s[(r-5)*o+t+3]=N,s[(r-4)*o+t-4]=N,s[(r-4)*o+t-3]=N,s[(r-4)*o+t-2]=N,a[i=(r-4)*o+t-1]!==A&&(a[i]=L,s[i]=N),a[i=(r-4)*o+t]!==A&&(a[i]=L,s[i]=N),a[i=(r-4)*o+t+1]!==A&&(a[i]=L,s[i]=N),s[(r-4)*o+t+2]=N,s[(r-4)*o+t+3]=N,s[(r-4)*o+t+4]=N,s[(r-3)*o+t-5]=N,s[(r-3)*o+t-4]=N,s[(r-3)*o+t-3]=N,a[i=(r-3)*o+t-2]!==A&&(a[i]=L,s[i]=N),a[i=(r-3)*o+t-1]!==A&&(a[i]=L,s[i]=N),a[i=(r-3)*o+t]!==A&&(a[i]=L,s[i]=N),a[i=(r-3)*o+t+1]!==A&&(a[i]=L,s[i]=N),a[i=(r-3)*o+t+2]!==A&&(a[i]=L,s[i]=N),s[(r-3)*o+t+3]=N,s[(r-3)*o+t+4]=N,s[(r-3)*o+t+5]=N,s[(r-2)*o+t-5]=N,s[(r-2)*o+t-4]=N,a[i=(r-2)*o+t-3]!==A&&(a[i]=L,s[i]=N),a[i=(r-2)*o+t-2]!==A&&(a[i]=L,s[i]=N),a[i=(r-2)*o+t-1]!==A&&(a[i]=L,s[i]=N),a[i=(r-2)*o+t]!==A&&(a[i]=L,s[i]=N),a[i=(r-2)*o+t+1]!==A&&(a[i]=L,s[i]=N),a[i=(r-2)*o+t+2]!==A&&(a[i]=L,s[i]=N),a[i=(r-2)*o+t+3]!==A&&(a[i]=L,s[i]=N),s[(r-2)*o+t+4]=N,s[(r-2)*o+t+5]=N,s[(r-1)*o+t-6]=N,s[(r-1)*o+t-5]=N,a[i=(r-1)*o+t-4]!==A&&(a[i]=L,s[i]=N),a[i=(r-1)*o+t-3]!==A&&(a[i]=L,s[i]=N),a[i=(r-1)*o+t-2]!==A&&(a[i]=L,s[i]=N),a[i=(r-1)*o+t-1]!==A&&(a[i]=L,s[i]=N),a[i=(r-1)*o+t]!==A&&(a[i]=L,s[i]=N),a[i=(r-1)*o+t+1]!==A&&(a[i]=L,s[i]=N),a[i=(r-1)*o+t+2]!==A&&(a[i]=L,s[i]=N),a[i=(r-1)*o+t+3]!==A&&(a[i]=L,s[i]=N),a[i=(r-1)*o+t+4]!==A&&(a[i]=L,s[i]=N),s[(r-1)*o+t+5]=N,s[(r-1)*o+t+6]=N,s[r*o+t-6]=N,s[r*o+t-5]=N,a[i=r*o+t-4]!==A&&(a[i]=L,s[i]=N),a[i=r*o+t-3]!==A&&(a[i]=L,s[i]=N),a[i=r*o+t-2]!==A&&(a[i]=L,s[i]=N),a[i=r*o+t-1]!==A&&(a[i]=L,s[i]=N),a[i=r*o+t]!==A&&(a[i]=L,s[i]=N),a[i=r*o+t+1]!==A&&(a[i]=L,s[i]=N),a[i=r*o+t+2]!==A&&(a[i]=L,s[i]=N),a[i=r*o+t+3]!==A&&(a[i]=L,s[i]=N),a[i=r*o+t+4]!==A&&(a[i]=L,s[i]=N),s[r*o+t+5]=N,s[r*o+t+6]=N,s[(r+1)*o+t-6]=N,s[(r+1)*o+t-5]=N,a[i=(r+1)*o+t-4]!==A&&(a[i]=L,s[i]=N),a[i=(r+1)*o+t-3]!==A&&(a[i]=L,s[i]=N),a[i=(r+1)*o+t-2]!==A&&(a[i]=L,s[i]=N),a[i=(r+1)*o+t-1]!==A&&(a[i]=L,s[i]=N),a[i=(r+1)*o+t]!==A&&(a[i]=L,s[i]=N),a[i=(r+1)*o+t+1]!==A&&(a[i]=L,s[i]=N),a[i=(r+1)*o+t+2]!==A&&(a[i]=L,s[i]=N),a[i=(r+1)*o+t+3]!==A&&(a[i]=L,s[i]=N),a[i=(r+1)*o+t+4]!==A&&(a[i]=L,s[i]=N),s[(r+1)*o+t+5]=N,s[(r+1)*o+t+6]=N,s[(r+2)*o+t-5]=N,s[(r+2)*o+t-4]=N,a[i=(r+2)*o+t-3]!==A&&(a[i]=L,s[i]=N),a[i=(r+2)*o+t-2]!==A&&(a[i]=L,s[i]=N),a[i=(r+2)*o+t-1]!==A&&(a[i]=L,s[i]=N),a[i=(r+2)*o+t]!==A&&(a[i]=L,s[i]=N),a[i=(r+2)*o+t+1]!==A&&(a[i]=L,s[i]=N),a[i=(r+2)*o+t+2]!==A&&(a[i]=L,s[i]=N),a[i=(r+2)*o+t+3]!==A&&(a[i]=L,s[i]=N),s[(r+2)*o+t+4]=N,s[(r+2)*o+t+5]=N,s[(r+3)*o+t-5]=N,s[(r+3)*o+t-4]=N,s[(r+3)*o+t-3]=N,a[i=(r+3)*o+t-2]!==A&&(a[i]=L,s[i]=N),a[i=(r+3)*o+t-1]!==A&&(a[i]=L,s[i]=N),a[i=(r+3)*o+t]!==A&&(a[i]=L,s[i]=N),a[i=(r+3)*o+t+1]!==A&&(a[i]=L,s[i]=N),a[i=(r+3)*o+t+2]!==A&&(a[i]=L,s[i]=N),s[(r+3)*o+t+3]=N,s[(r+3)*o+t+4]=N,s[(r+3)*o+t+5]=N,s[(r+4)*o+t-4]=N,s[(r+4)*o+t-3]=N,s[(r+4)*o+t-2]=N,a[i=(r+4)*o+t-1]!==A&&(a[i]=L,s[i]=N),a[i=(r+4)*o+t]!==A&&(a[i]=L,s[i]=N),a[i=(r+4)*o+t+1]!==A&&(a[i]=L,s[i]=N),s[(r+4)*o+t+2]=N,s[(r+4)*o+t+3]=N,s[(r+4)*o+t+4]=N,s[(r+5)*o+t-3]=N,s[(r+5)*o+t-2]=N,s[(r+5)*o+t-1]=N,s[(r+5)*o+t]=N,s[(r+5)*o+t+1]=N,s[(r+5)*o+t+2]=N,s[(r+5)*o+t+3]=N,s[(r+6)*o+t-1]=N,s[(r+6)*o+t]=N,s[(r+6)*o+t+1]=N;break;default:throw new Error("Unhandled width: "+n)}}function l(e,t,r,n,i,o,a,s){var u,l,f,h,c,p,d=!0,v=!1,g=s.width,m=s.height,y=s.condition,b=s.outside,x=i*g;if(0!==r[x+n])return null;if(f=i-1,h=i+1,u=n-1,l=n+1,c=0,n>0?(c|=i>0?y(t[x+n])<<3:b<<3,c|=h<m?y(t[x+g+n])<<0:b<<0):(c|=b<<3,c|=b<<0),l<g?(c|=i>0?y(t[x+l])<<2:b<<2,c|=h<m?y(t[x+g+l])<<1:b<<1):(c|=b<<2,c|=b<<1),0===c||15===c)return null;switch(c){case 1:p=[n,i+.5];break;case 2:p=[n+.5,h];break;case 3:p=[n,i+.5];break;case 4:p=[l,i+.5];break;case 5:p=d?[n,i+.5]:[l,i+.5];break;case 6:p=[n+.5,h];break;case 7:p=[n,i+.5];break;case 8:case 9:p=[n+.5,i];break;case 10:p=v?[n+.5,i]:[n+.5,h];break;case 11:p=[n+.5,i];break;case 12:case 13:p=[l,i+.5];break;case 14:p=[n+.5,h];break;default:throw new Error("Invalid cell value")}do{switch(r[x+n]=e,c){case 1:p.push(n+.5,h),i=h,d=!1,v=!0;break;case 2:case 3:p.push(l,i+.5),n=l,d=!0,v=!1;break;case 4:p.push(n+.5,i),i=f,d=!1,v=!1;break;case 5:d?(p.push(n+.5,i),i=f,v=!1):(p.push(n+.5,h),i=h,v=!0),d=!1;break;case 6:case 7:p.push(n+.5,i),i=f,d=!1,v=!1;break;case 8:p.push(n,i+.5),n=u,d=!1,v=!1;break;case 9:p.push(n+.5,h),i=h,d=!1,v=!0;break;case 10:v?(p.push(l,i+.5),n=l,d=!0):(p.push(n,i+.5),n=u,d=!1),v=!1;break;case 11:p.push(l,i+.5),n=l,d=!0,v=!1;break;case 12:p.push(n,i+.5),n=u,d=!1,v=!1;break;case 13:p.push(n+.5,h),i=h,d=!1,v=!0;break;case 14:p.push(n,i+.5),n=u,d=!1,v=!1;break;default:throw new Error("Unhandled cell value: "+JSON.stringify({cellCase:c,x:n,y:i},null,4))}x=i*g,f=i-1,h=i+1,u=n-1,l=n+1,c=0,n>0?(c|=i>0?y(t[x+n])<<3:b<<3,c|=h<m?y(t[x+g+n])<<0:b<<0):(c|=b<<3,c|=b<<0),l<g?(c|=i>0?y(t[x+l])<<2:b<<2,c|=h<m?y(t[x+g+l])<<1:b<<1):(c|=b<<2,c|=b<<1)}while(n!==o||i!==a);return p}function f(e,t,r,n,i,o){var a=i-r,s=o-n,u=Math.sqrt(a*a+s*s);u>0&&(a/=u,s/=u);var l=e-r,f=t-n,h=a*l+s*f,c=l-h*a,p=f-h*s;return Math.sqrt(c*c+p*p)}function h(e,t){var r=arguments.length>2&&void 0!==arguments[2]&&arguments[2];r&&e.push(e[0],e[1]);var n=[e[0],e[1]];return function e(t,r,n,i,o){for(var a=0,s=0,u=t[r],l=t[r+1],h=t[n],c=t[n+1],p=r+2;p<n;p+=2){var d=f(t[p],t[p+1],u,l,h,c);d>a&&(s=p,a=d)}a>i?(e(t,r,s,i,o),e(t,s,n,i,o)):o.push(h,c)}(e,0,e.length-2,t,n),r?n.slice(0,n.length-2):n}var c,p=r(3);function d(e,t){for(var r=0;r<t.length;r++){var n=t[r];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,n.key,n)}}function v(e,t){var r=Object.keys(e);return Object.getOwnPropertySymbols&&r.push.apply(r,Object.getOwnPropertySymbols(e)),t&&(r=r.filter(function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable})),r}function g(e){for(var t=1;t<arguments.length;t++){var r=null!=arguments[t]?arguments[t]:{};t%2?v(r,!0).forEach(function(t){m(e,t,r[t])}):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(r)):v(r).forEach(function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(r,t))})}return e}function m(e,t,r){return t in e?Object.defineProperty(e,t,{value:r,enumerable:!0,configurable:!0,writable:!0}):e[t]=r,e}r.d(t,"c",function(){return A}),r.d(t,"b",function(){return L}),r.d(t,"d",function(){return N}),r.d(t,"a",function(){return X}),r.d(t,"f",function(){return ae}),r.d(t,"e",function(){return le});var y=2*Math.PI,b=1.4,x=20,w=5,k=.034,T=2e3;function C(e){return e<-1?-1:e>1?1:e}var M=.05,S=.07,z=.09,_=.5,A=1,P=2,O=3,E=4,I=5,R=6,j=7,L=8,B=9,F=10,D=5,N=6,U=8,G=10,Y=11,W=15,V=17,X=18;function H(e){if(!e)return 0;for(var t=0,r=1;r<e.length;r+=2)t+=e[r];return t}var q=[0,0,.5,1,1,-2,1,1,0];var J=function(e){for(var t in e)if(e.hasOwnProperty(t)){var r=e[t];if(r)for(var n=H(r),i=1;i<r.length;i+=2)r[i]/=n}return e}((m(c={},A,[9,1]),m(c,P,[0,500,W,1,V,1,16,1]),m(c,O,[0,1e3,G,2,Y,2,12,3,14,3,W,1,V,1,16,2]),m(c,E,[0,1e3,G,2,Y,2,12,3,14,3,W,1,V,1,16,2]),m(c,I,[U,4,W,1,V,1,16,1]),m(c,R,[7,150,G,2,Y,2,12,5,13,5,14,5,2,1,3,1,4,1,W,1,V,1,16,2]),m(c,j,[7,40,G,2,Y,2,12,5,13,5,14,5,2,1,3,1,4,1,W,1,V,1,16,2]),m(c,L,[N,1]),c));function K(e,t,r){var n=e.things,i=(e.size,e.sizeMask);if(0===n[t]){var o=J[r];if(o){var a=function(e,t){if(t.length<4)return t[0];var r=e.random.next(),n=1;do{r-=t[n],n+=2}while(r>0&&n<t.length);return t[n-3]}(e,o);if(a)if(a===G||a===Y){var s=t-2&i,u=t-1&i,l=t+1&i,f=t+2&i,h=t+3&i;n[t-3&i]!==U&&n[s]!==U&&n[u]!==U&&(n[t]=a,n[l]=U,n[f]=U,n[h]=U)}else if(a===W||a===V){var c=t+1&i;n[t-1&i]!==U&&(n[t]=a,n[c]=U)}else n[t]=a}}}var Q=[0,0];function Z(e,t,r,n){var i,o=e.heightCoords(t,r),a=e.heightFn(t,r,o,Q);if(n=C(n-.96*a+.2*Q[1]),a<M)i=A;else if(a<S)i=P;else if(a<_){var s=o.nx,u=o.ny,l=o.nz,f=o.nw,h=a>z?e.noise4D(s*w,f*w,u*w,l*w):1,c=e.noise4D(s*x,f*x,u*x,l*x);i=h<0?c<0?R:j:c<0?O:E}else i=I;if(n<.4){if(i===A)return F;if(i===j||i===O||i===E||i===P)return B;if(i===R)return I}else if(n>.95&&(i===R||i===j||i===O||i===E))return P;return i}function $(e,t,r,n){for(var i=new le(e,t),o=i.tiles,a=0,s=e/20|0,u=y/2/e,l=0,f=0;f<e;f++){var h=Math.sin(l);l+=u;for(var c=0;c<e;c++){var p=Z(i,c,f,h);o[a]=p,K(i,a,p),a++}r&&f%s==0&&r(n*f/e)}return i}var ee=[0,-1,-1,0,1,0,0,1];function te(e,t){for(var r=t.value,n=t.x,i=t.y,o=e.size,a=!1,s=0;s<ee.length;s+=2){var u=t.x+ee[s],l=t.y+ee[s+1];if(u>0&&l>0&&u<o&&l<o){var f=e.heightFn(u,l);f>r&&(r=f,n=u,i=l,a=!0)}}return!!a&&{x:n,y:i,value:r,points:[]}}function re(e){var t=function(e){for(var t=[],r=e.size,n=r*r/1e3,i=0;i<n;i++){var o=e.random.next()*r|0,a=e.random.next()*r|0,s=e.heightFn(o,a);s>M&&t.push({x:o,y:a,value:s,points:[],tile:0})}return t}(e),r=e.size,n=t.length,i=0,o=0;for(o=0;o<r/2&&i<n;o++)for(var a=i;a<n;a++){var s=te(e,t[a]);if(s)t[a]=s;else{var u=t[i];t[i]=t[a],t[a]=u,i++}}return function(e,t){for(var r=arguments.length>2&&void 0!==arguments[2]?arguments[2]:8,n=[],i=0;i<t.length;i++){var o=t[i],a=e.random.nextInt(-r,r),s=e.random.nextInt(-r,r);o.x=o.x+a,o.y=o.y+s,e.heightFn(o.x,o.y)>_&&e.random.next()<.6&&n.push(g({},o,{points:[],x:o.x-r-s|0,y:o.y-r+a|0}))}return t.concat(n)}(e,function(e){for(var t=e.length,r=[],n=0;n<t;n++){for(var i=e[n],o=!0,a=t-1;a>n;a--){var s=e[a];if(i.x===s.x&&i.y===s.y){o=!1;break}}o&&r.push(i)}return r}(t))}function ne(e,t){for(var r=1/0,n=t.x,i=t.y,o=-1,a=-1,s=!1,u=e.size,l=0;l<ee.length;l+=2){var f=t.x+ee[l],h=t.y+ee[l+1];if(f>0&&h>0&&f<u&&h<u){var c=e.read(f,h);if(c!==L){if(c===I){var p=e.heightCoords(f,h),d=p.nx,v=p.ny,g=p.nz,m=p.nw;c=e.noise4D(d*x,m*x,v*x,g*x)<0?O:E}var y=e.heightFn(f,h)-(c!==P&&c===t.tile?.001:0);y<r&&(r=y,n=f,i=h,o=c,a=l,s=!0)}}}if(s){var b=e.random.next();if(b<.25){var w=2*(a/2+(b<.125?-1:1)&3);t.x+=ee[w],t.y+=ee[w+1],t.points.push(t.x,t.y),t.x+=ee[w],t.y+=ee[w+1],t.value=1,t.tile=e.read(t.x,t.y)}else t.x=n,t.y=i,t.value=r,t.tile=o}else{var k=2*e.random.nextInt(0,3);t.x+=ee[k],t.y+=ee[k+1],t.tile=e.read(t.x,t.y)}}function ie(e){var t,r=re(e),n=e.size,i=r.length,o=0,a=0;for(a=0;a<n&&o<i;a++)for(var s=o;s<i;s++){var l=r[s],f=l.x,h=l.y;l.points.push(f,h);var c=e.read(l.x,l.y);if(c!==A&&c!==B&&c!==F)ne(e,l);else{var p=r[o];r[o]=r[s],r[s]=p,o++}}for(var d=0;d<r.length;d++)for(var v=r[d].points,g=0;g<v.length;g+=2){var m=(t=g,0|Math.min(8,.008*t));u(e,v[g],v[g+1],m)}return r}function oe(e,t){for(var r=function(e,t){t.sort(function(e,t){return e.points.length-t.points.length}),t.length;var r=function(e){var t=(e.length-1)/2;return t%1?e[0|t].points.length+e[1+(0|t)].points.length/2:e[0|t].points.length}(t);return t.filter(function(e){return e.points.length>2*r})}(0,t).filter(function(t,r){var n,i=t.points,o=i.length,a=o*k|0,s=i[o-2],u=i[o-1];for(n=o-4;n>0;n-=2){var l=i[n]-s,f=i[n+1]-u;if(Math.sqrt(l*l+f*f)>a)break}for(var h=function(e,t,r){for(var n,i,o=1/0,a=0;a<ee.length;a+=2){for(var s=ee[a],u=ee[a+1],l=1,f=t+s,h=r+u;e.read(f,h)===L;)l++,f+=s,h+=u;l<o&&(o=l,n=f,i=h)}return{px:n,py:i}}(e,i[n],i[n+1]),c=h.px,p=h.py,d=a*a,v=0,g=-a;g<a;g++)for(var m=0|Math.sqrt(d-g*g),y=-m;y<m;y++)v+=q[e.read(c+y,p+g)];return t.centerX=c&e.sizeMask,t.centerY=p&e.sizeMask,t.radius=a,v>T}),n=0;n<r.length;n++)for(var i=r[n],o=i.centerX,a=i.centerY,s=i.radius,u=s*s,l=-s;l<=s;l++){var f=Math.round(Math.sqrt(u-l*l));e.putThing(o+f,a+l,D),e.putThing(o-f,a+l,D)}return r}function ae(e,t,r){for(var n=r.length,i=r[n-2],o=r[n-1],a=!1,s=0;s<n;s+=2){var u=r[s],l=r[s+1];l>t!=o>t&&e<u+(i-u)*(t-l)/(o-l)&&(a=!a),i=u,o=l}return a}var se=2.5;function ue(e,t){var r=function(e,t,r,n,i){if(e.length!==t*r)throw new Error("array size does not match width*height: "+JSON.stringify({array:e.length,width:t,height:r}));for(var o=s()(),a=new Uint8Array(t*r),u=[],f={width:t,height:r,condition:n,outside:i},h=0;h<r;h++)for(var c=0;c<t;c++){var p=l(u.length+1,e,a,c,h,c,h,f);p&&p.length>6&&u.push(p)}return console.log("Marching squares done in "+(s()()-o)+"ms"),u}(e.things,e.size,e.size,function(e){return e>=U},!0);console.log("MARCHING-CUBE: polygons = ",r.length,", vertexes = ",r.reduce(function(e,t){return e+t.length},0));var n=r.map(function(e){return h(e,se,!0)}).filter(function(e){return e.length>6});console.log("SIMPLIFIED: polygons = ",n.length,", vertexes = ",n.reduce(function(e,t){return e+t.length},0));var i=function(e){for(var t=[],r=0;r<e.length;r++)t=t.concat(e[r]);return t}(n),o=p.a.triangulate(i);console.log("DELAUNAY: triangles",o.length/3,", vertexes = ",o.length);var a=function(e,t,r){return r}(0,0,o);console.log("WALKABLE: triangles",a.length/3,", vertexes = ",a.length),e.vertices=i,e.polygons=n,e.triangles=a}var le=function(){function e(){var t=this,r=arguments.length>0&&void 0!==arguments[0]?arguments[0]:800,n=arguments.length>1?arguments[1]:void 0,a=arguments.length>2?arguments[2]:void 0,s=arguments.length>3?arguments[3]:void 0;if(function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,e),Math.log(r)/Math.log(2)%1!=0)throw new Error("Size must be power of two: "+r);this.random=new o.a(n),this.noise=new i.a(function(){return t.random.next()}),this.size=r,this.sizeMask=r-1,this.fineMask=(r<<4)-1,this.factor=1/r,this.tiles=a||new Uint8Array(r*r),this.things=s||new Uint8Array(r*r)}var t,r,n;return t=e,n=[{key:"deserialize",value:function(t){var r=t.size,n=t.seed,i=t.things;return new e(r,n,t.tiles,i)}},{key:"generate",value:function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:(new Date).getTime(),r=arguments.length>2?arguments[2]:void 0,n=s()(),i=$(e,t,r,.75),o=s()(),a=ie(i),u=s()();r&&r(.87);oe(i,a);var l=s()();ue(i),r&&r(1);var f=s()();return console.log("Base in ".concat(o-n,"ms")),console.log("Rivers in ".concat(u-n,"ms")),console.log("Cities in ".concat(l-n,"ms")),console.log("Roads in ".concat(f-n,"ms")),i}}],(r=[{key:"read",value:function(e,t){return this.tiles[(t&this.sizeMask)*this.size+(e&this.sizeMask)]}},{key:"getThing",value:function(e,t){return this.things[(t&this.sizeMask)*this.size+(e&this.sizeMask)]}},{key:"write",value:function(e,t,r){this.tiles[(t&this.sizeMask)*this.size+(e&this.sizeMask)]=r}},{key:"putThing",value:function(e,t,r){this.things[(t&this.sizeMask)*this.size+(e&this.sizeMask)]=r}},{key:"heightFn",value:function(e,t,r){var n,i,o,a,s=arguments.length>3&&void 0!==arguments[3]?arguments[3]:null,u=e*this.factor,l=t*this.factor;r?(n=r.nx,i=r.ny,o=r.nz,a=r.nw):(n=Math.cos(u*y),i=Math.cos(l*y),o=Math.sin(u*y),a=Math.sin(l*y));var f=this.noise4D(.4*n,.4*i,.4*o,.4*a),h=this.noise4D(n*b,a*b,i*b,o*b);return s&&(s[0]=f,s[1]=h),C(f<0?-f*f:f*f)+.3*h}},{key:"heightCoords",value:function(e,t){var r=e*this.factor,n=t*this.factor;return{nx:Math.cos(r*y),ny:Math.cos(n*y),nz:Math.sin(r*y),nw:Math.sin(n*y)}}},{key:"render",value:function(e){for(var t=this.size,r=e.createImageData(t,t),n=r.data,i=0,o=0,a=0;a<t;a++)for(var s=0;s<t;s++){switch(this.tiles[i++]){case L:n[o++]=128,n[o++]=128,n[o++]=255,n[o++]=255;break;case A:n[o++]=0,n[o++]=32,n[o++]=128,n[o++]=255;break;case P:n[o++]=192,n[o++]=160,n[o++]=0,n[o++]=255;break;case O:n[o++]=0,n[o++]=128,n[o++]=0,n[o++]=255;break;case R:n[o++]=0,n[o++]=108,n[o++]=16,n[o++]=255;break;case j:n[o++]=0,n[o++]=64,n[o++]=32,n[o++]=255;break;case E:n[o++]=64,n[o++]=64,n[o++]=0,n[o++]=255;break;case I:n[o++]=100,n[o++]=100,n[o++]=100,n[o++]=255;break;case B:n[o++]=248,n[o++]=248,n[o++]=255,n[o++]=255;break;case F:n[o++]=220,n[o++]=220,n[o++]=255,n[o++]=255}}return r}},{key:"noise4D",value:function(e,t,r,n){return this.noise.noise4D(e,t,r,n)}},{key:"serialize",value:function(){return{_:"Map serialization",size:this.size,seed:this.random._seed,tiles:this.tiles,things:this.things}}}])&&d(t.prototype,r),n&&d(t,n),e}()},10:function(e,t,r){(function(e){!function(t){var r=function(e){this.tileAnim=[0,0],this.dontUseTransform=!1,this.renderer=e,this.tileAnim=[0,0]};t.CanvasTileRenderer=r;var n=e.CanvasRenderer;n&&n.registerPlugin("tilemap",r)}(r||(r={}));var t,r,n=this&&this.__extends||(t=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var r in t)t.hasOwnProperty(r)&&(e[r]=t[r])},function(e,r){function n(){this.constructor=e}t(e,r),e.prototype=null===r?Object.create(r):(n.prototype=r.prototype,new n)});!function(t){var r=function(r){function i(e,t,n){var i=r.call(this)||this;return i.modificationMarker=0,i.shadowColor=new Float32Array([0,0,0,.5]),i._globalMat=null,i.initialize.apply(i,arguments),i}return n(i,r),i.prototype.updateTransform=function(){this.displayObjectUpdateTransform()},i.prototype.initialize=function(e,r,n){!0===n&&(n=0),this.z=this.zIndex=e,this.texPerChild=n||t.Constant.boundCountPerBuffer*t.Constant.maxTextures,r&&this.setBitmaps(r)},i.prototype.setBitmaps=function(e){var r,n=this.texPerChild,i=this.children.length,o=Math.ceil(e.length/n);for(r=0;r<i;r++)this.children[r].TEXTURES=e.slice(r*n,(r+1)*n);for(r=i;r<o;r++){var a=new t.RectTileLayer(this.zIndex,e.slice(r*n,(r+1)*n));a.compositeParent=!0,a.offsetX=t.Constant.boundSize,a.offsetY=t.Constant.boundSize,this.addChild(a)}},i.prototype.clear=function(){for(var e=0;e<this.children.length;e++)this.children[e].clear();this.modificationMarker=0},i.prototype.addRect=function(e,t,r,n,i,o,a){var s=e/this.texPerChild>>0,u=e%this.texPerChild;this.children[s]&&this.children[s].textures&&this.children[s].addRect(u,t,r,n,i,o,a)},i.prototype.addFrame=function(r,n,i,o,a){var s,u=null,l=0,f=this.children;if("number"==typeof r){if(u=f[r/this.texPerChild>>0])l=r%this.texPerChild;else{if(!(u=f[0]))return!1;l=0}s=u.textures[l]}else{s="string"==typeof r?e.Texture.from(r):r;for(var h=0;h<f.length;h++){for(var c=(d=f[h]).textures,p=0;p<c.length;p++)if(c[p].baseTexture===s.baseTexture){u=d,l=p;break}if(u)break}if(!u){for(h=0;h<f.length;h++){var d;if((d=f[h]).textures.length<this.texPerChild){u=d,l=d.textures.length,d.textures.push(s);break}}u||((u=new t.RectTileLayer(this.zIndex,s)).compositeParent=!0,u.offsetX=t.Constant.boundSize,u.offsetY=t.Constant.boundSize,f.push(u),l=0)}}return u.addRect(l,s.frame.x,s.frame.y,n,i,s.frame.width,s.frame.height,o,a),!0},i.prototype.renderCanvas=function(e){if(this.visible&&!(this.worldAlpha<=0)&&this.renderable){if(!e.plugins.tilemap.dontUseTransform){var t=this.worldTransform;e.context.setTransform(t.a,t.b,t.c,t.d,t.tx*e.resolution,t.ty*e.resolution)}for(var r=this.children,n=0;n<r.length;n++)r[n].renderCanvasCore(e)}},i.prototype.render=function(e){if(this.visible&&!(this.worldAlpha<=0)&&this.renderable){var t=e.plugins.tilemap,r=t.getShader();e.batch.setObjectRenderer(t),this._globalMat=r.uniforms.projTransMatrix,e.globalUniforms.uniforms.projectionMatrix.copyTo(this._globalMat).append(this.worldTransform),r.uniforms.shadowColor=this.shadowColor,r.uniforms.animationFrame=t.tileAnim,e.shader.bind(r,!1);for(var n=this.children,i=0;i<n.length;i++)n[i].renderWebGLCore(e,t)}},i.prototype.isModified=function(e){var t=this.children;if(this.modificationMarker!==t.length)return!0;for(var r=0;r<t.length;r++)if(t[r].isModified(e))return!0;return!1},i.prototype.clearModify=function(){var e=this.children;this.modificationMarker=e.length;for(var t=0;t<e.length;t++)e[t].clearModify()},i}(e.Container);t.CompositeRectTileLayer=r}(r||(r={})),function(t){t.Constant={maxTextures:4,bufferSize:2048,boundSize:1024,boundCountPerBuffer:1,use32bitIndex:!1,SCALE_MODE:e.SCALE_MODES.LINEAR,DO_CLEAR:!0}}(r||(r={})),r||(r={}),function(t){function r(e){var r=t.call(this)||this;return r.zIndex=e,r}n(r,t),r.prototype.renderCanvas=function(t){var r=null;t.plugins.tilemap.dontUseTransform&&(r=this.transform.worldTransform,this.transform.worldTransform=e.Matrix.IDENTITY),t.plugins.graphics.render(this),t.plugins.tilemap.dontUseTransform&&(this.transform.worldTransform=r),t.context.globalAlpha=1},r.prototype.isModified=function(e){return!1},r.prototype.clearModify=function(){}}(e.Graphics),function(t){var r=function(r){function i(t){var n=r.call(this,t.bufferSize,t.bufferSize)||this;n.DO_CLEAR=!1,n.boundSize=0,n._clearBuffer=null,n.baseTex=null,n.boundSprites=[],n.dirties=[];var i=n.boundSprites,o=n.dirties;n.boundSize=t.boundSize;for(var a=0;a<t.boundCountPerBuffer;a++){var s=new e.Sprite;s.position.x=t.boundSize*(1&a),s.position.y=t.boundSize*(a>>1),i.push(s),o.push(0)}return n.DO_CLEAR=!!t.DO_CLEAR,n}return n(i,r),i.prototype.bind=function(e){if(this.baseTex)throw new Error("Only one baseTexture is allowed for this resource!");this.baseTex=e,r.prototype.bind.call(this,e)},i.prototype.setTexture=function(e,t){var r=this.boundSprites[e];r.texture.baseTexture!==t.baseTexture&&(r.texture=t,this.baseTex.update(),this.dirties[e]=this.baseTex.dirtyId)},i.prototype.upload=function(e,r,n){var i=e.gl,o=this.width,a=this.height;i.pixelStorei(i.UNPACK_PREMULTIPLY_ALPHA_WEBGL,r.premultiplyAlpha),n.dirtyId<0&&(n.width=o,n.height=a,i.texImage2D(r.target,0,r.format,o,a,0,r.format,r.type,null));var s=this.DO_CLEAR;s&&!this._clearBuffer&&(this._clearBuffer=new Uint8Array(t.Constant.boundSize*t.Constant.boundSize*4));for(var u=this.boundSprites,l=0;l<u.length;l++){var f=u[l],h=f.texture.baseTexture;if(!(n.dirtyId>=this.dirties[l])){var c=h.resource;h.valid&&c&&c.source&&(s&&(h.width<this.boundSize||h.height<this.boundSize)&&i.texSubImage2D(r.target,0,f.position.x,f.position.y,this.boundSize,this.boundSize,r.format,r.type,this._clearBuffer),i.texSubImage2D(r.target,0,f.position.x,f.position.y,r.format,r.type,c.source))}}return!0},i}(e.resources.Resource);t.MultiTextureResource=r}(r||(r={})),function(t){var r=function(r){function i(e,t){var n=r.call(this)||this;return n.zIndex=0,n.modificationMarker=0,n.shadowColor=new Float32Array([0,0,0,.5]),n._globalMat=null,n.pointsBuf=[],n.hasAnim=!1,n.offsetX=0,n.offsetY=0,n.compositeParent=!1,n.vbId=0,n.vb=null,n.vbBuffer=null,n.vbArray=null,n.vbInts=null,n.initialize(e,t),n}return n(i,r),i.prototype.initialize=function(e,t){t?t instanceof Array||!t.baseTexture||(t=[t]):t=[],this.textures=t,this.zIndex=e},i.prototype.clear=function(){this.pointsBuf.length=0,this.modificationMarker=0,this.hasAnim=!1},i.prototype.addFrame=function(t,r,n,i,o){var a,s=0;if("number"==typeof t)s=t,a=this.textures[s];else{a="string"==typeof t?e.Texture.from(t):t;for(var u=!1,l=this.textures,f=0;f<l.length;f++)if(l[f].baseTexture===a.baseTexture){s=f,u=!0;break}if(!u)return!1}return this.addRect(s,a.frame.x,a.frame.y,r,n,a.frame.width,a.frame.height,i,o),!0},i.prototype.addRect=function(e,t,r,n,i,o,a,s,u){void 0===s&&(s=0),void 0===u&&(u=0);var l=this.pointsBuf;if(this.hasAnim=this.hasAnim||s>0||u>0,o===a)l.push(t),l.push(r),l.push(n),l.push(i),l.push(o),l.push(a),l.push(0|s),l.push(0|u),l.push(e);else{var f=void 0;if(o%a==0)for(f=0;f<o/a;f++)l.push(t+f*a),l.push(r),l.push(n+f*a),l.push(i),l.push(a),l.push(a),l.push(0|s),l.push(0|u),l.push(e);else if(a%o==0)for(f=0;f<a/o;f++)l.push(t),l.push(r+f*o),l.push(n),l.push(i+f*o),l.push(o),l.push(o),l.push(0|s),l.push(0|u),l.push(e);else l.push(t),l.push(r),l.push(n),l.push(i),l.push(o),l.push(a),l.push(0|s),l.push(0|u),l.push(e)}},i.prototype.renderCanvas=function(e){if(!e.plugins.tilemap.dontUseTransform){var t=this.worldTransform;e.context.setTransform(t.a,t.b,t.c,t.d,t.tx*e.resolution,t.ty*e.resolution)}this.renderCanvasCore(e)},i.prototype.renderCanvasCore=function(e){if(0!==this.textures.length){var t=this.pointsBuf;e.context.fillStyle="#000000";for(var r=0,n=t.length;r<n;r+=9){var i=t[r],o=t[r+1],a=t[r+2],s=t[r+3],u=t[r+4],l=t[r+5];i+=t[r+6]*e.plugins.tilemap.tileAnim[0],o+=t[r+7]*e.plugins.tilemap.tileAnim[1];var f=t[r+8];f>=0?e.context.drawImage(this.textures[f].baseTexture.source,i,o,u,l,a,s,u,l):(e.context.globalAlpha=.5,e.context.fillRect(a,s,u,l),e.context.globalAlpha=1)}}},i.prototype.destroyVb=function(){this.vb&&(this.vb.destroy(),this.vb=null)},i.prototype.render=function(e){var t=e.plugins.tilemap,r=t.getShader();e.batch.setObjectRenderer(t),this._globalMat=r.uniforms.projTransMatrix,e.globalUniforms.uniforms.projectionMatrix.copyTo(this._globalMat).append(this.worldTransform),r.uniforms.shadowColor=this.shadowColor,r.uniforms.animationFrame=t.tileAnim,e.shader.bind(r,!1),this.renderWebGLCore(e,t)},i.prototype.renderWebGLCore=function(r,n){var i=this.pointsBuf;if(0!==i.length){var o=i.length/9,a=n.getShader(),s=this.textures;if(0!==s.length){n.bindTextures(r,a,s);var u=this.vb;u||(u=n.createVb(),this.vb=u,this.vbId=u.id,this.vbBuffer=null,this.modificationMarker=0),n.checkIndexBuffer(o,u);var l=t.Constant.boundCountPerBuffer,f=u.getBuffer("aVertexPosition"),h=o*u.vertPerQuad;if(0!==h){if(this.modificationMarker!==h){this.modificationMarker=h;var c=u.stride*h;if(!this.vbBuffer||this.vbBuffer.byteLength<c){for(var p=u.stride;p<c;)p*=2;this.vbBuffer=new ArrayBuffer(p),this.vbArray=new Float32Array(this.vbBuffer),this.vbInts=new Uint32Array(this.vbBuffer),f.update(this.vbBuffer)}for(var d=this.vbArray,v=(this.vbInts,0),g=0,m=this.offsetX,y=this.offsetY,b=0;b<i.length;b+=9){this.compositeParent&&(l>1?(g=i[b+8]>>2,m=this.offsetX*(1&i[b+8]),y=this.offsetY*(i[b+8]>>1&1)):(g=i[b+8],m=0,y=0));var x=i[b+2],w=i[b+3],k=i[b+4],T=i[b+5],C=i[b]+m,M=i[b+1]+y,S=i[b+6],z=i[b+7];d[v++]=x,d[v++]=w,d[v++]=C,d[v++]=M,d[v++]=C+.5,d[v++]=M+.5,d[v++]=C+k-.5,d[v++]=M+T-.5,d[v++]=S,d[v++]=z,d[v++]=g,d[v++]=x+k,d[v++]=w,d[v++]=C+k,d[v++]=M,d[v++]=C+.5,d[v++]=M+.5,d[v++]=C+k-.5,d[v++]=M+T-.5,d[v++]=S,d[v++]=z,d[v++]=g,d[v++]=x+k,d[v++]=w+T,d[v++]=C+k,d[v++]=M+T,d[v++]=C+.5,d[v++]=M+.5,d[v++]=C+k-.5,d[v++]=M+T-.5,d[v++]=S,d[v++]=z,d[v++]=g,d[v++]=x,d[v++]=w+T,d[v++]=C,d[v++]=M+T,d[v++]=C+.5,d[v++]=M+.5,d[v++]=C+k-.5,d[v++]=M+T-.5,d[v++]=S,d[v++]=z,d[v++]=g}f.update(d)}r.geometry.bind(u,a),r.geometry.draw(e.DRAW_MODES.TRIANGLES,6*o,0)}}}},i.prototype.isModified=function(e){return!!(this.modificationMarker!==this.pointsBuf.length||e&&this.hasAnim)},i.prototype.clearModify=function(){this.modificationMarker=this.pointsBuf.length},i.prototype.destroy=function(e){r.prototype.destroy.call(this,e),this.destroyVb()},i}(e.Container);t.RectTileLayer=r}(r||(r={})),function(t){var r="\nvarying vec2 vTextureCoord;\nvarying vec4 vFrame;\nvarying float vTextureId;\nuniform vec4 shadowColor;\nuniform sampler2D uSamplers[%count%];\nuniform vec2 uSamplerSize[%count%];\n\nvoid main(void){\n   vec2 textureCoord = clamp(vTextureCoord, vFrame.xy, vFrame.zw);\n   float textureId = floor(vTextureId + 0.5);\n\n   vec4 color;\n   %forloop%\n   gl_FragColor = color;\n}\n",i="\nattribute vec2 aVertexPosition;\nattribute vec2 aTextureCoord;\nattribute vec4 aFrame;\nattribute vec2 aAnim;\nattribute float aTextureId;\n\nuniform mat3 projTransMatrix;\nuniform vec2 animationFrame;\n\nvarying vec2 vTextureCoord;\nvarying float vTextureId;\nvarying vec4 vFrame;\n\nvoid main(void){\n   gl_Position = vec4((projTransMatrix * vec3(aVertexPosition, 1.0)).xy, 0.0, 1.0);\n   vec2 anim = aAnim * animationFrame;\n   vTextureCoord = aTextureCoord + anim;\n   vFrame = aFrame + vec4(anim, anim);\n   vTextureId = aTextureId;\n}\n",o=function(r){function i(n,i,o){var a=r.call(this,new e.Program(i,o),{animationFrame:new Float32Array(2),uSamplers:[],uSamplerSize:[],projTransMatrix:new e.Matrix})||this;return a.maxTextures=0,a.maxTextures=n,t.shaderGenerator.fillSamplers(a,a.maxTextures),a}return n(i,r),i}(e.Shader);t.TilemapShader=o;var a=function(e){function o(n){var o=e.call(this,n,i,t.shaderGenerator.generateFragmentSrc(n,r))||this;return t.shaderGenerator.fillSamplers(o,o.maxTextures),o}return n(o,e),o}(o);t.RectTileShader=a;var s=function(t){function r(){var r=t.call(this)||this;r.vertSize=11,r.vertPerQuad=4,r.stride=4*r.vertSize,r.lastTimeAccess=0;var n=r.buf=new e.Buffer(new Float32Array(2),!0,!1);return r.addAttribute("aVertexPosition",n,0,!1,0,r.stride,0).addAttribute("aTextureCoord",n,0,!1,0,r.stride,8).addAttribute("aFrame",n,0,!1,0,r.stride,16).addAttribute("aAnim",n,0,!1,0,r.stride,32).addAttribute("aTextureId",n,0,!1,0,r.stride,40),r}return n(r,t),r}(e.Geometry);t.RectTileGeom=s}(r||(r={})),function(t){var r=function(r){function i(n){var i=r.call(this,n)||this;return i.sn=-1,i.indexBuffer=null,i.ibLen=0,i.tileAnim=[0,0],i.texLoc=[],i.texResources=[],i.rectShader=new t.RectTileShader(t.Constant.maxTextures),i.indexBuffer=new e.Buffer(void 0,!0,!0),i.checkIndexBuffer(2e3),i.initBounds(),i}return n(i,r),i.prototype.initBounds=function(){if(!(t.Constant.boundCountPerBuffer<=1))for(var r=t.Constant.maxTextures,n=0;n<r;n++){var i=new t.MultiTextureResource(t.Constant),o=new e.BaseTexture(i);o.scaleMode=t.Constant.SCALE_MODE,o.wrapMode=e.WRAP_MODES.CLAMP,this.texResources.push(i)}},i.prototype.bindTexturesWithoutRT=function(e,t,r){var n=t.uniforms.uSamplerSize;this.texLoc.length=0;for(var i=0;i<r.length;i++){var o=r[i];if(!o||!o.valid)return;e.texture.bind(r[i],i),n[2*i]=1/r[i].baseTexture.width,n[2*i+1]=1/r[i].baseTexture.height}t.uniforms.uSamplerSize=n},i.prototype.bindTextures=function(e,r,n){var i=n.length,o=t.Constant.maxTextures;if(!(i>t.Constant.boundCountPerBuffer*o))if(t.Constant.boundCountPerBuffer<=1)this.bindTexturesWithoutRT(e,r,n);else{for(var a=0;a<i;a++){var s=n[a];if(s&&s.valid)this.texResources[a>>2].setTexture(3&a,s)}var u=a+3>>2;for(a=0;a<u;a++)e.texture.bind(this.texResources[a].baseTex,a)}},i.prototype.start=function(){},i.prototype.createVb=function(){var e=new t.RectTileGeom;return e.addIndex(this.indexBuffer),e.lastTimeAccess=Date.now(),e},i.prototype.checkIndexBuffer=function(r,n){void 0===n&&(n=null);var i=6*r;if(!(i<=this.ibLen)){for(var o=i;o<i;)o<<=1;this.ibLen=i,this.indexBuffer.update(e.utils.createIndicesForQuads(r,t.Constant.use32bitIndex))}},i.prototype.getShader=function(){return this.rectShader},i.prototype.destroy=function(){r.prototype.destroy.call(this),this.rectShader=null},i}(e.ObjectRenderer);t.TileRenderer=r,e.Renderer.registerPlugin("tilemap",r)}(r||(r={})),function(t){var r=function(t){function r(e,r){var n=t.call(this)||this;return n._lastAnimationFrame=-1,n.tilemap=e,n.z=r,n}return n(r,t),r.prototype.clear=function(){for(var e=this.children,t=0;t<e.length;t++)e[t].clear();this._previousLayers=0},r.prototype.cacheIfDirty=function(){var t=this.tilemap,r=this.children,n=this._previousLayers!==r.length;this._previousLayers=r.length;var i,o=this.canvasBuffer,a=this._tempRender;if(o||(o=this.canvasBuffer=document.createElement("canvas"),(a=this._tempRender=new e.CanvasRenderer(100,100,{view:o})).context=a.rootContext,a.plugins.tilemap.dontUseTransform=!0),o.width===t._layerWidth&&o.height===t._layerHeight||(o.width=t._layerWidth,o.height=t._layerHeight,n=!0),!n)for(i=0;i<r.length;i++)if(r[i].isModified(this._lastAnimationFrame!==t.animationFrame)){n=!0;break}if(this._lastAnimationFrame=t.animationFrame,n)for(t._hackRenderer&&t._hackRenderer(a),a.context.clearRect(0,0,o.width,o.height),i=0;i<r.length;i++)r[i].clearModify(),r[i].renderCanvas(a);for(this.layerTransform=this.worldTransform,i=0;i<r.length;i++){this.layerTransform=r[i].worldTransform;break}},r.prototype.renderCanvas=function(e){this.cacheIfDirty();var t=this.layerTransform;e.context.setTransform(t.a,t.b,t.c,t.d,t.tx*e.resolution,t.ty*e.resolution);this.tilemap;e.context.drawImage(this.canvasBuffer,0,0)},r}(e.Container);t.ZLayer=r}(r||(r={})),function(t){e.tilemap=t}(r||(r={})),function(e){!function(t){t.fillSamplers=function(t,r){for(var n=[],i=0;i<r;i++)n[i]=i;t.uniforms.uSamplers=n;var o=[];for(i=0;i<r;i++)o.push(1/e.Constant.bufferSize),o.push(1/e.Constant.bufferSize);t.uniforms.uSamplerSize=o},t.generateFragmentSrc=function(e,t){return t.replace(/%count%/gi,e+"").replace(/%forloop%/gi,this.generateSampleSrc(e))},t.generateSampleSrc=function(e){var t="";t+="\n",t+="\n",t+="if(vTextureId <= -1.0) {",t+="\n\tcolor = shadowColor;",t+="\n}";for(var r=0;r<e;r++)t+="\nelse ",r<e-1&&(t+="if(textureId == "+r+".0)"),t+="\n{",t+="\n\tcolor = texture2D(uSamplers["+r+"], textureCoord * uSamplerSize["+r+"]);",t+="\n}";return t+="\n",t+="\n"}}(e.shaderGenerator||(e.shaderGenerator={}))}(r||(r={}))}).call(this,r(4))},20:function(e,t,r){e.exports=function(){return new Worker(r.p+"4473ae86e186768231ce.worker.js")}},3:function(e,t,r){"use strict";var n=1/1048576;function i(e,t,r,i){var o,a,s,u,l,f,h,c,p,d,v=e[2*t],g=e[2*t+1],m=e[2*r],y=e[2*r+1],b=e[2*i],x=e[2*i+1],w=Math.abs(g-y),k=Math.abs(y-x);if(w<n&&k<n)throw new Error("Eek! Coincident points!");return w<n?a=(u=-(b-m)/(x-y))*((o=(m+v)/2)-(f=(m+b)/2))+(c=(y+x)/2):k<n?a=(s=-(m-v)/(y-g))*((o=(b+m)/2)-(l=(v+m)/2))+(h=(g+y)/2):(o=((s=-(m-v)/(y-g))*(l=(v+m)/2)-(u=-(b-m)/(x-y))*(f=(m+b)/2)+(c=(y+x)/2)-(h=(g+y)/2))/(s-u),a=w>k?s*(o-l)+h:u*(o-f)+c),{i:t,j:r,k:i,x:o,y:a,r:(p=m-o)*p+(d=y-a)*d}}function o(e){var t,r,n,i,o,a;for(r=e.length;r;)for(i=e[--r],n=e[--r],t=r;t;)if(a=e[--t],n===(o=e[--t])&&i===a||n===a&&i===o){e.splice(r,2),e.splice(t,2);break}}var a={triangulate:function(e){var t,r,a,s,u,l,f,h,c,p,d,v,g=e.length/2;if(g<3)return[];for(e=e.slice(0),a=new Array(g),t=g;t--;)a[t]=t;for(a.sort(function(t,r){var n=e[2*r]-e[2*t];return 0!==n?n:t-r}),s=function(e){var t,r,n,i,o,a,s=Number.POSITIVE_INFINITY,u=Number.POSITIVE_INFINITY,l=Number.NEGATIVE_INFINITY,f=Number.NEGATIVE_INFINITY;for(t=e.length;t--;)e[2*t]<s&&(s=e[2*t]),e[2*t]>l&&(l=e[2*t]),e[2*t+1]<u&&(u=e[2*t+1]),e[2*t+1]>f&&(f=e[2*t+1]);return n=f-u,[(o=s+.5*(r=l-s))-20*(i=Math.max(r,n)),(a=u+.5*n)-i,o,a+20*i,o+20*i,a-i]}(e),u=[i(e=e.concat(s),g+0,g+1,g+2)],l=[],f=[],t=a.length;t--;f.length=0){for(v=a[t],r=u.length;r--;)(h=e[2*v]-u[r].x)>0&&h*h>u[r].r?(l.push(u[r]),u.splice(r,1)):h*h+(c=e[2*v+1]-u[r].y)*c-u[r].r>n||(f.push(u[r].i,u[r].j,u[r].j,u[r].k,u[r].k,u[r].i),u.splice(r,1));for(o(f),r=f.length;r;)d=f[--r],p=f[--r],u.push(i(e,p,d,v))}for(t=u.length;t--;)l.push(u[t]);for(u.length=0,t=l.length;t--;)l[t].i<g&&l[t].j<g&&l[t].k<g&&u.push(l[t].i,l[t].j,l[t].k);for(var m=0;m<u.length;m++)u[m]*=2;return u},contains:function(e,t,r,n,i,o,a){if(i<e[t]&&i<e[r]&&i<e[n]||i>e[t]&&i>e[r]&&i>e[n]||o<e[t+1]&&o<e[r+1]&&o<e[n+1]||o>e[t+1]&&o>e[r+1]&&o>e[n+1])a.isNull=!0;else{var s=e[r]-e[t],u=e[n]-e[t],l=e[r+1]-e[t+1],f=e[n+1]-e[t+1],h=s*f-u*l;if(0===h)return null;var c=(f*(i-e[t])-u*(o-e[t+1]))/h,p=(s*(o-e[t+1])-l*(i-e[t]))/h;c<0||p<0||c+p>1?a.isNull=!0:(a.u=c,a.v=p,a.isNull=!1)}}};t.a=a},32:function(e,t,r){},37:function(e,t,r){"use strict";r.r(t);var n=r(4);r(10),r(32);function i(e,t){for(var r=0;r<t.length;r++){var n=t[r];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,n.key,n)}}function o(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}var a=function e(t,r){var n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:null;o(this,e),this.ctx=t,this.parent=n,this.input=r};function s(e,t){for(var r=e.classes,n=0;n<r.length;n++){if(r[n]===t)return}throw new Error(t+" is not a registered class in this scene graph")}var u,l=function(){function e(t,r,n){o(this,e),this.classes=t,this.ctx=r,this.ctx.graph=this,this.current=new t[0](this.ctx,n),console.log("SCENE-GRAPH",this)}var t,r,n;return t=e,(r=[{key:"start",value:function(){this.onEnter()}},{key:"onEnter",value:function(){"function"==typeof this.current.onEnter&&this.current.onEnter()}},{key:"onExit",value:function(){"function"==typeof this.current.onExit&&this.current.onExit()}},{key:"ticker",value:function(e){"function"==typeof this.current.ticker&&this.current.ticker(e),"function"==typeof this.current.render&&this.current.render()}},{key:"push",value:function(e,t){s(this,e),this.current=new e(this.ctx,t,this.current)}},{key:"pop",value:function(){var e=this.current.parent;if(!e)throw new Error("Cannot pop without parent");this.onExit(),this.current=e}},{key:"goto",value:function(e,t){s(this,e),this.current=new e(this.ctx,t,null)}}])&&i(t.prototype,r),n&&i(t,n),e}(),f=r(1),h=["ms-dark.png","ms-water.png","ms-sand.png","ms-grass.png","ms-dirt.png","ms-rock.png","ms-woods.png","ms-woods2.png","ms-river.png","ms-ice.png","ms-ice2.png"],c=[null,null,"plant.png","plant2.png","plant3.png","dot.png",null,null,null,null,"large-tree.png","large-tree2.png","small-tree.png","small-tree2.png","small-tree3.png","boulder.png","boulder2.png","boulder3.png","house.png"];function p(e,t,r,n){var i=!(arguments.length>4&&void 0!==arguments[4])||arguments[4],o=e.tileLayer,a=e.atlas,s=e.width,l=e.height,f=s/2,p=l/2,d=Math.ceil(s/16)+5,v=Math.ceil(l/16)+9;o.clear();var g=t.sizeMask,m=t.fineMask,y=(t.size,r-f&m),b=n-p&m,x=-32-(15&y),w=-32-(15&b),k=(y>>4)-2&g,T=(b>>4)-2&g,C=n>>4|0,M=h.length;u=0;for(var S=1,z=0;z<M;z++){if(0===z||u&S)for(var _=0;_<v;_++)for(var A=0;A<d;A++){var P=t.read(k+A,T+_),O=t.read(k+A+1,T+_),E=t.read(k+A,T+_+1),I=t.read(k+A+1,T+_+1),R=(P===z?8:0)+(O===z?4:0)+(E===z?1:0)+(I===z?2:0);if(0===z&&(u|=1<<P),0!==R){1===R&&I!==P?R=16:2===R&&O!==E?R=17:4===R&&P!==I?R=18:8===R&&E!==O&&(R=19);var j=h[z];j+="-"+R;var L=a.frames[j];if(null===L)throw new Error("No texture '"+j+"'");var B=L.pivot,F=L.frame;o.addFrame(j,x+(A<<4)-(B.x*F.w|0),w+(_<<4)-(B.y*F.h|0))}}S*=2}for(var D=0;D<v;D++){i&&(T+D&g)==(C+1&g)&&(15&n)<8&&o.addFrame("bunny.png",f,p-20);for(var N=0;N<d;N++){var U=t.getThing(k+N&g,T+D&g),G=c[U];if(G){var Y=a.frames[G],W=Y.pivot,V=Y.frame;o.addFrame(G,x+(N<<4)-W.x*V.w|0,w+(D<<4)-W.y*V.h|0)}}i&&(T+D&g)==(C+1&g)&&(15&n)>=8&&o.addFrame("bunny.png",f,p-20)}i&&o.addFrame("bunny-outline.png",f,p-20)}function d(e){return(d="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e})(e)}function v(e,t){for(var r=0;r<t.length;r++){var n=t[r];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,n.key,n)}}function g(e,t){return!t||"object"!==d(t)&&"function"!=typeof t?function(e){if(void 0===e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return e}(e):t}function m(e){return(m=Object.setPrototypeOf?Object.getPrototypeOf:function(e){return e.__proto__||Object.getPrototypeOf(e)})(e)}function y(e,t){return(y=Object.setPrototypeOf||function(e,t){return e.__proto__=t,e})(e,t)}var b=1023,x=1193,w=function(e){function t(e,r,n){var i;!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,t),i=g(this,m(t).call(this,e,r,n));var o=r.map;return o.putThing(b,x,f.a),i.ctx.map=o,i}var r,n,i;return function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function");e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,writable:!0,configurable:!0}}),t&&y(e,t)}(t,a),r=t,(n=[{key:"ticker",value:function(e){}},{key:"render",value:function(){p(this.ctx,this.input.map,this.ctx.posX,this.ctx.posY)}}])&&v(r.prototype,n),i&&v(r,i),t}(),k=r(20),T=0,C={},M=new(r.n(k).a);M.addEventListener("message",function(e){var t=e.data,r=t.type,n=t.ticket,i=C[n];if(i){var o=i.resolve,a=i.onProgress;switch(r){case"MAPRESULT":o(f.e.deserialize(t.payload)),C[n]=null;break;case"PROGRESS":a?a(t.percent):console.log(Math.round(100*t.percent)+"%")}}else console.log("INVALID TICKET: "+JSON.stringify(t))},!0);var S=[[0,2,0,0,2,0,2,0,2,0,2,0,2,0,2,0,0,2,0,0],[2,2,0,0,0,2,0,0,0,2,0,0,0,2,0,0,0,2,0,0],[2,2,2,0,0,0,2,0,0,2,2,0,2,0,0,0,2,2,2,0],[2,2,0,0,0,0,2,0,0,2,0,0,0,0,2,0,2,2,0,0],[2,0,2,0,2,0,2,0,2,2,2,0,0,0,2,0,0,0,2,0],[2,2,2,0,2,0,0,0,2,2,0,0,0,0,2,0,2,2,0,0],[0,2,2,0,2,0,0,0,2,2,0,0,2,0,2,0,0,2,0,0],[2,2,2,0,0,0,2,0,0,0,2,0,0,0,2,0,0,0,2,0],[0,2,0,0,2,0,2,0,0,2,0,0,2,0,2,0,0,2,0,0],[0,2,0,0,2,0,2,0,0,2,2,0,0,0,2,0,2,2,2,0],[1,0,0,1,0,0,1,0,0,1,1,0,0,1,0,0,1,0,0,1]];function z(e,t,r,n){var i=0,o=S[n];if(!o)throw new Error("No array for "+n);for(var a=0;a<5;a++)for(var s=0;s<4;s++)e.write(t+s,r+a,o[i]),i++}function _(e){return(_="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e})(e)}function A(e,t){for(var r=0;r<t.length;r++){var n=t[r];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,n.key,n)}}function P(e,t){return!t||"object"!==_(t)&&"function"!=typeof t?function(e){if(void 0===e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return e}(e):t}function O(e){return(O=Object.setPrototypeOf?Object.getPrototypeOf:function(e){return e.__proto__||Object.getPrototypeOf(e)})(e)}function E(e,t){return(E=Object.setPrototypeOf||function(e,t){return e.__proto__=t,e})(e,t)}var I,R=function(e){function t(e,r,n){return function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,t),P(this,O(t).call(this,e,r,n))}var r,n,i;return function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function");e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,writable:!0,configurable:!0}}),t&&E(e,t)}(t,a),r=t,(n=[{key:"onEnter",value:function(){var e,t,r,n=this;this.map=new f.e(128,"start"),(e="floppy-disk",t=function(e){for(var t=String(Math.round(100*e)),r=Math.round(4*(t.length+1)/2),i=0;i<t.length;i++){var o=t.charCodeAt(i)-48;z(n.map,4*i-r,-3,o)}z(n.map,-r+4*t.length,-3,10)},r=++T,new Promise(function(n){M.postMessage({type:"GENERATE",seed:e,ticket:r}),C[r]={resolve:n,onProgress:t}})).then(function(e){return n.ctx.graph.goto(w,{map:e})})}},{key:"render",value:function(){p(this.ctx,this.map,0,0,!1)}}])&&A(r.prototype,n),i&&A(r,i),t}();window.onload=function(){n.Loader.shared.add("atlas/atlas-0.json").load(W)};var j=16400,L=19152,B=j,F=L,D=0,N=0,U=.5,G=12,Y={app:null,atlas:null,container:null,map:null,width:-1,height:-1,tileLayer:null,scale:2,posX:j,posY:L,controls:{moveLeftRight:0,moveUpDown:0,action:!1,meta:!1}};function W(e,t){var r=t["atlas/atlas-0.json"].data,i=function(e){for(var t=1,r=e;r>1024;)r/=2,t*=2;return console.log("Set scale to",t),t}(window.innerWidth),o=window.innerWidth/i|0,a=window.innerHeight/i|0;console.log({width:o,height:a});var s=o/2,u=a/2,f=new n.Application({width:o,height:a,backgroundColor:1118481,resolution:(window.devicePixelRatio||1)*i});document.body.appendChild(f.view),I=new n.tilemap.CompositeRectTileLayer(0,n.utils.TextureCache["atlas/atlas-0.json_image"]);var h=new n.Container;h.addChild(I),f.stage.addChild(h),h.x=f.screen.width/2,h.y=f.screen.height/2,h.pivot.x=s,h.pivot.y=u,Object.assign(Y,{tileLayer:I,atlas:r,width:o,height:a,app:f,container:h,scale:i,posX:B,posY:F});var c=new l([R,w],Y);f.ticker.add(function(e){!function(e){var t=Y.controls,r=t.moveLeftRight,n=t.moveUpDown;r?(D+=r*U,Math.abs(D)>G&&(D=Math.sign(D)*G)):D=Math.abs(D)>.1?.8*D:0,n?(N+=n*U,Math.abs(N)>G&&(N=Math.sign(N)*G)):N=Math.abs(N)>.1?.8*N:0,Y.map&&(B=B+D*e&Y.map.fineMask,F=F+N*e&Y.map.fineMask,Y.posX=B,Y.posY=F)}(e),c.ticker(e)}),window.addEventListener("keydown",function(e){var t=e.keyCode;switch(t){case 80:console.log("POS",B>>4|0,F>>4|0,", fine = ",B,F,", layerMask = ",getCurrentLayerMask());break;case 36:B=j,F=L;break;case 35:B=0,F=0;break;case 38:case 87:Y.controls.moveUpDown=-1;break;case 37:case 65:Y.controls.moveLeftRight=-1;break;case 40:case 83:Y.controls.moveUpDown=1;break;case 39:case 68:Y.controls.moveLeftRight=1;break;default:console.log("keyCode = ",t)}},!0),window.addEventListener("keyup",function(e){switch(e.keyCode){case 38:case 87:case 40:case 83:Y.controls.moveUpDown=0;break;case 37:case 65:case 39:case 68:Y.controls.moveLeftRight=0}},!0),window.addEventListener("resize",function(e){Y.width=window.innerWidth/Y.scale|0,Y.height=window.innerHeight/Y.scale|0,f.renderer.resize(Y.width,Y.height)},!0),c.start()}}});
//# sourceMappingURL=bundle-main-17a0f2763bb0ccddc8ca.js.map