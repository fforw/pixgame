var Game=function(e){function t(t){for(var n,o,s=t[0],u=t[1],h=t[2],l=0,c=[];l<s.length;l++)o=s[l],i[o]&&c.push(i[o][0]),i[o]=0;for(n in u)Object.prototype.hasOwnProperty.call(u,n)&&(e[n]=u[n]);for(f&&f(t);c.length;)c.shift()();return a.push.apply(a,h||[]),r()}function r(){for(var e,t=0;t<a.length;t++){for(var r=a[t],n=!0,s=1;s<r.length;s++){var u=r[s];0!==i[u]&&(n=!1)}n&&(a.splice(t--,1),e=o(o.s=r[0]))}return e}var n={},i={2:0},a=[];function o(t){if(n[t])return n[t].exports;var r=n[t]={i:t,l:!1,exports:{}};return e[t].call(r.exports,r,r.exports,o),r.l=!0,r.exports}o.m=e,o.c=n,o.d=function(e,t,r){o.o(e,t)||Object.defineProperty(e,t,{enumerable:!0,get:r})},o.r=function(e){"undefined"!=typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(e,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(e,"__esModule",{value:!0})},o.t=function(e,t){if(1&t&&(e=o(e)),8&t)return e;if(4&t&&"object"==typeof e&&e&&e.__esModule)return e;var r=Object.create(null);if(o.r(r),Object.defineProperty(r,"default",{enumerable:!0,value:e}),2&t&&"string"!=typeof e)for(var n in e)o.d(r,n,function(t){return e[t]}.bind(null,n));return r},o.n=function(e){var t=e&&e.__esModule?function(){return e.default}:function(){return e};return o.d(t,"a",t),t},o.o=function(e,t){return Object.prototype.hasOwnProperty.call(e,t)},o.p="";var s=window.webpackJsonpGame=window.webpackJsonpGame||[],u=s.push.bind(s);s.push=t,s=s.slice();for(var h=0;h<s.length;h++)t(s[h]);var f=u;return a.push([33,0]),r()}({1:function(e,t,r){"use strict";var n=r(8),i=r.n(n),a=r(5),o=r(0),s=r.n(o);function u(e,t,r,n){var i,a=e.size,o=e.tiles,s=e.things;switch(n){case 0:case 1:s[(r-1)*a+t-1]=N,s[(r-1)*a+t]=N,s[(r-1)*a+t+1]=N,s[r*a+t-1]=N,o[i=r*a+t]!==A&&(o[i]=F,s[i]=N),s[r*a+t+1]=N,s[(r+1)*a+t-1]=N,s[(r+1)*a+t]=N,s[(r+1)*a+t+1]=N;break;case 2:s[(r-1)*a+t-1]=N,s[(r-1)*a+t]=N,s[(r-1)*a+t+1]=N,s[(r-1)*a+t+2]=N,s[r*a+t-1]=N,o[i=r*a+t]!==A&&(o[i]=F,s[i]=N),o[i=r*a+t+1]!==A&&(o[i]=F,s[i]=N),s[r*a+t+2]=N,s[(r+1)*a+t-1]=N,s[(r+1)*a+t]=N,s[(r+1)*a+t+1]=N,s[(r+1)*a+t+2]=N;break;case 3:s[(r-3)*a+t]=N,s[(r-3)*a+t+1]=N,s[(r-2)*a+t-1]=N,s[(r-2)*a+t]=N,s[(r-2)*a+t+1]=N,s[(r-2)*a+t+2]=N,s[(r-1)*a+t-2]=N,s[(r-1)*a+t-1]=N,o[i=(r-1)*a+t]!==A&&(o[i]=F,s[i]=N),o[i=(r-1)*a+t+1]!==A&&(o[i]=F,s[i]=N),s[(r-1)*a+t+2]=N,s[(r-1)*a+t+3]=N,s[r*a+t-2]=N,s[r*a+t-1]=N,o[i=r*a+t]!==A&&(o[i]=F,s[i]=N),o[i=r*a+t+1]!==A&&(o[i]=F,s[i]=N),s[r*a+t+2]=N,s[r*a+t+3]=N,s[(r+1)*a+t-1]=N,s[(r+1)*a+t]=N,s[(r+1)*a+t+1]=N,s[(r+1)*a+t+2]=N,s[(r+2)*a+t]=N,s[(r+2)*a+t+1]=N;break;case 4:s[(r-3)*a+t-1]=N,s[(r-3)*a+t]=N,s[(r-3)*a+t+1]=N,s[(r-2)*a+t-2]=N,s[(r-2)*a+t-1]=N,s[(r-2)*a+t]=N,s[(r-2)*a+t+1]=N,s[(r-2)*a+t+2]=N,s[(r-1)*a+t-3]=N,s[(r-1)*a+t-2]=N,o[i=(r-1)*a+t-1]!==A&&(o[i]=F,s[i]=N),o[i=(r-1)*a+t]!==A&&(o[i]=F,s[i]=N),o[i=(r-1)*a+t+1]!==A&&(o[i]=F,s[i]=N),s[(r-1)*a+t+2]=N,s[(r-1)*a+t+3]=N,s[r*a+t-3]=N,s[r*a+t-2]=N,o[i=r*a+t-1]!==A&&(o[i]=F,s[i]=N),o[i=r*a+t]!==A&&(o[i]=F,s[i]=N),o[i=r*a+t+1]!==A&&(o[i]=F,s[i]=N),s[r*a+t+2]=N,s[r*a+t+3]=N,s[(r+1)*a+t-2]=N,s[(r+1)*a+t-1]=N,s[(r+1)*a+t]=N,s[(r+1)*a+t+1]=N,s[(r+1)*a+t+2]=N,s[(r+2)*a+t-1]=N,s[(r+2)*a+t]=N,s[(r+2)*a+t+1]=N;break;case 5:s[(r-3)*a+t-1]=N,s[(r-3)*a+t]=N,s[(r-3)*a+t+1]=N,s[(r-2)*a+t-2]=N,s[(r-2)*a+t-1]=N,s[(r-2)*a+t]=N,s[(r-2)*a+t+1]=N,s[(r-2)*a+t+2]=N,s[(r-1)*a+t-3]=N,s[(r-1)*a+t-2]=N,o[i=(r-1)*a+t-1]!==A&&(o[i]=F,s[i]=N),o[i=(r-1)*a+t]!==A&&(o[i]=F,s[i]=N),o[i=(r-1)*a+t+1]!==A&&(o[i]=F,s[i]=N),s[(r-1)*a+t+2]=N,s[(r-1)*a+t+3]=N,s[r*a+t-3]=N,s[r*a+t-2]=N,o[i=r*a+t-1]!==A&&(o[i]=F,s[i]=N),o[i=r*a+t]!==A&&(o[i]=F,s[i]=N),o[i=r*a+t+1]!==A&&(o[i]=F,s[i]=N),s[r*a+t+2]=N,s[r*a+t+3]=N,s[(r+1)*a+t-3]=N,s[(r+1)*a+t-2]=N,o[i=(r+1)*a+t-1]!==A&&(o[i]=F,s[i]=N),o[i=(r+1)*a+t]!==A&&(o[i]=F,s[i]=N),o[i=(r+1)*a+t+1]!==A&&(o[i]=F,s[i]=N),s[(r+1)*a+t+2]=N,s[(r+1)*a+t+3]=N,s[(r+2)*a+t-2]=N,s[(r+2)*a+t-1]=N,s[(r+2)*a+t]=N,s[(r+2)*a+t+1]=N,s[(r+2)*a+t+2]=N,s[(r+3)*a+t-1]=N,s[(r+3)*a+t]=N,s[(r+3)*a+t+1]=N;break;case 6:s[(r-4)*a+t-1]=N,s[(r-4)*a+t]=N,s[(r-4)*a+t+1]=N,s[(r-3)*a+t-2]=N,s[(r-3)*a+t-1]=N,s[(r-3)*a+t]=N,s[(r-3)*a+t+1]=N,s[(r-3)*a+t+2]=N,s[(r-2)*a+t-3]=N,s[(r-2)*a+t-2]=N,o[i=(r-2)*a+t-1]!==A&&(o[i]=F,s[i]=N),o[i=(r-2)*a+t]!==A&&(o[i]=F,s[i]=N),o[i=(r-2)*a+t+1]!==A&&(o[i]=F,s[i]=N),s[(r-2)*a+t+2]=N,s[(r-2)*a+t+3]=N,s[(r-1)*a+t-4]=N,s[(r-1)*a+t-3]=N,o[i=(r-1)*a+t-2]!==A&&(o[i]=F,s[i]=N),o[i=(r-1)*a+t-1]!==A&&(o[i]=F,s[i]=N),o[i=(r-1)*a+t]!==A&&(o[i]=F,s[i]=N),o[i=(r-1)*a+t+1]!==A&&(o[i]=F,s[i]=N),o[i=(r-1)*a+t+2]!==A&&(o[i]=F,s[i]=N),s[(r-1)*a+t+3]=N,s[(r-1)*a+t+4]=N,s[r*a+t-4]=N,s[r*a+t-3]=N,o[i=r*a+t-2]!==A&&(o[i]=F,s[i]=N),o[i=r*a+t-1]!==A&&(o[i]=F,s[i]=N),o[i=r*a+t]!==A&&(o[i]=F,s[i]=N),o[i=r*a+t+1]!==A&&(o[i]=F,s[i]=N),o[i=r*a+t+2]!==A&&(o[i]=F,s[i]=N),s[r*a+t+3]=N,s[r*a+t+4]=N,s[(r+1)*a+t-4]=N,s[(r+1)*a+t-3]=N,o[i=(r+1)*a+t-2]!==A&&(o[i]=F,s[i]=N),o[i=(r+1)*a+t-1]!==A&&(o[i]=F,s[i]=N),o[i=(r+1)*a+t]!==A&&(o[i]=F,s[i]=N),o[i=(r+1)*a+t+1]!==A&&(o[i]=F,s[i]=N),o[i=(r+1)*a+t+2]!==A&&(o[i]=F,s[i]=N),s[(r+1)*a+t+3]=N,s[(r+1)*a+t+4]=N,s[(r+2)*a+t-3]=N,s[(r+2)*a+t-2]=N,o[i=(r+2)*a+t-1]!==A&&(o[i]=F,s[i]=N),o[i=(r+2)*a+t]!==A&&(o[i]=F,s[i]=N),o[i=(r+2)*a+t+1]!==A&&(o[i]=F,s[i]=N),s[(r+2)*a+t+2]=N,s[(r+2)*a+t+3]=N,s[(r+3)*a+t-2]=N,s[(r+3)*a+t-1]=N,s[(r+3)*a+t]=N,s[(r+3)*a+t+1]=N,s[(r+3)*a+t+2]=N,s[(r+4)*a+t-1]=N,s[(r+4)*a+t]=N,s[(r+4)*a+t+1]=N;break;case 7:s[(r-5)*a+t-1]=N,s[(r-5)*a+t]=N,s[(r-5)*a+t+1]=N,s[(r-4)*a+t-2]=N,s[(r-4)*a+t-1]=N,s[(r-4)*a+t]=N,s[(r-4)*a+t+1]=N,s[(r-4)*a+t+2]=N,s[(r-3)*a+t-3]=N,s[(r-3)*a+t-2]=N,o[i=(r-3)*a+t-1]!==A&&(o[i]=F,s[i]=N),o[i=(r-3)*a+t]!==A&&(o[i]=F,s[i]=N),o[i=(r-3)*a+t+1]!==A&&(o[i]=F,s[i]=N),s[(r-3)*a+t+2]=N,s[(r-3)*a+t+3]=N,s[(r-2)*a+t-4]=N,s[(r-2)*a+t-3]=N,o[i=(r-2)*a+t-2]!==A&&(o[i]=F,s[i]=N),o[i=(r-2)*a+t-1]!==A&&(o[i]=F,s[i]=N),o[i=(r-2)*a+t]!==A&&(o[i]=F,s[i]=N),o[i=(r-2)*a+t+1]!==A&&(o[i]=F,s[i]=N),o[i=(r-2)*a+t+2]!==A&&(o[i]=F,s[i]=N),s[(r-2)*a+t+3]=N,s[(r-2)*a+t+4]=N,s[(r-1)*a+t-5]=N,s[(r-1)*a+t-4]=N,o[i=(r-1)*a+t-3]!==A&&(o[i]=F,s[i]=N),o[i=(r-1)*a+t-2]!==A&&(o[i]=F,s[i]=N),o[i=(r-1)*a+t-1]!==A&&(o[i]=F,s[i]=N),o[i=(r-1)*a+t]!==A&&(o[i]=F,s[i]=N),o[i=(r-1)*a+t+1]!==A&&(o[i]=F,s[i]=N),o[i=(r-1)*a+t+2]!==A&&(o[i]=F,s[i]=N),o[i=(r-1)*a+t+3]!==A&&(o[i]=F,s[i]=N),s[(r-1)*a+t+4]=N,s[(r-1)*a+t+5]=N,s[r*a+t-5]=N,s[r*a+t-4]=N,o[i=r*a+t-3]!==A&&(o[i]=F,s[i]=N),o[i=r*a+t-2]!==A&&(o[i]=F,s[i]=N),o[i=r*a+t-1]!==A&&(o[i]=F,s[i]=N),o[i=r*a+t]!==A&&(o[i]=F,s[i]=N),o[i=r*a+t+1]!==A&&(o[i]=F,s[i]=N),o[i=r*a+t+2]!==A&&(o[i]=F,s[i]=N),o[i=r*a+t+3]!==A&&(o[i]=F,s[i]=N),s[r*a+t+4]=N,s[r*a+t+5]=N,s[(r+1)*a+t-5]=N,s[(r+1)*a+t-4]=N,o[i=(r+1)*a+t-3]!==A&&(o[i]=F,s[i]=N),o[i=(r+1)*a+t-2]!==A&&(o[i]=F,s[i]=N),o[i=(r+1)*a+t-1]!==A&&(o[i]=F,s[i]=N),o[i=(r+1)*a+t]!==A&&(o[i]=F,s[i]=N),o[i=(r+1)*a+t+1]!==A&&(o[i]=F,s[i]=N),o[i=(r+1)*a+t+2]!==A&&(o[i]=F,s[i]=N),o[i=(r+1)*a+t+3]!==A&&(o[i]=F,s[i]=N),s[(r+1)*a+t+4]=N,s[(r+1)*a+t+5]=N,s[(r+2)*a+t-4]=N,s[(r+2)*a+t-3]=N,o[i=(r+2)*a+t-2]!==A&&(o[i]=F,s[i]=N),o[i=(r+2)*a+t-1]!==A&&(o[i]=F,s[i]=N),o[i=(r+2)*a+t]!==A&&(o[i]=F,s[i]=N),o[i=(r+2)*a+t+1]!==A&&(o[i]=F,s[i]=N),o[i=(r+2)*a+t+2]!==A&&(o[i]=F,s[i]=N),s[(r+2)*a+t+3]=N,s[(r+2)*a+t+4]=N,s[(r+3)*a+t-3]=N,s[(r+3)*a+t-2]=N,o[i=(r+3)*a+t-1]!==A&&(o[i]=F,s[i]=N),o[i=(r+3)*a+t]!==A&&(o[i]=F,s[i]=N),o[i=(r+3)*a+t+1]!==A&&(o[i]=F,s[i]=N),s[(r+3)*a+t+2]=N,s[(r+3)*a+t+3]=N,s[(r+4)*a+t-2]=N,s[(r+4)*a+t-1]=N,s[(r+4)*a+t]=N,s[(r+4)*a+t+1]=N,s[(r+4)*a+t+2]=N,s[(r+5)*a+t-1]=N,s[(r+5)*a+t]=N,s[(r+5)*a+t+1]=N;break;case 8:s[(r-6)*a+t-1]=N,s[(r-6)*a+t]=N,s[(r-6)*a+t+1]=N,s[(r-5)*a+t-3]=N,s[(r-5)*a+t-2]=N,s[(r-5)*a+t-1]=N,s[(r-5)*a+t]=N,s[(r-5)*a+t+1]=N,s[(r-5)*a+t+2]=N,s[(r-5)*a+t+3]=N,s[(r-4)*a+t-4]=N,s[(r-4)*a+t-3]=N,s[(r-4)*a+t-2]=N,o[i=(r-4)*a+t-1]!==A&&(o[i]=F,s[i]=N),o[i=(r-4)*a+t]!==A&&(o[i]=F,s[i]=N),o[i=(r-4)*a+t+1]!==A&&(o[i]=F,s[i]=N),s[(r-4)*a+t+2]=N,s[(r-4)*a+t+3]=N,s[(r-4)*a+t+4]=N,s[(r-3)*a+t-5]=N,s[(r-3)*a+t-4]=N,s[(r-3)*a+t-3]=N,o[i=(r-3)*a+t-2]!==A&&(o[i]=F,s[i]=N),o[i=(r-3)*a+t-1]!==A&&(o[i]=F,s[i]=N),o[i=(r-3)*a+t]!==A&&(o[i]=F,s[i]=N),o[i=(r-3)*a+t+1]!==A&&(o[i]=F,s[i]=N),o[i=(r-3)*a+t+2]!==A&&(o[i]=F,s[i]=N),s[(r-3)*a+t+3]=N,s[(r-3)*a+t+4]=N,s[(r-3)*a+t+5]=N,s[(r-2)*a+t-5]=N,s[(r-2)*a+t-4]=N,o[i=(r-2)*a+t-3]!==A&&(o[i]=F,s[i]=N),o[i=(r-2)*a+t-2]!==A&&(o[i]=F,s[i]=N),o[i=(r-2)*a+t-1]!==A&&(o[i]=F,s[i]=N),o[i=(r-2)*a+t]!==A&&(o[i]=F,s[i]=N),o[i=(r-2)*a+t+1]!==A&&(o[i]=F,s[i]=N),o[i=(r-2)*a+t+2]!==A&&(o[i]=F,s[i]=N),o[i=(r-2)*a+t+3]!==A&&(o[i]=F,s[i]=N),s[(r-2)*a+t+4]=N,s[(r-2)*a+t+5]=N,s[(r-1)*a+t-6]=N,s[(r-1)*a+t-5]=N,o[i=(r-1)*a+t-4]!==A&&(o[i]=F,s[i]=N),o[i=(r-1)*a+t-3]!==A&&(o[i]=F,s[i]=N),o[i=(r-1)*a+t-2]!==A&&(o[i]=F,s[i]=N),o[i=(r-1)*a+t-1]!==A&&(o[i]=F,s[i]=N),o[i=(r-1)*a+t]!==A&&(o[i]=F,s[i]=N),o[i=(r-1)*a+t+1]!==A&&(o[i]=F,s[i]=N),o[i=(r-1)*a+t+2]!==A&&(o[i]=F,s[i]=N),o[i=(r-1)*a+t+3]!==A&&(o[i]=F,s[i]=N),o[i=(r-1)*a+t+4]!==A&&(o[i]=F,s[i]=N),s[(r-1)*a+t+5]=N,s[(r-1)*a+t+6]=N,s[r*a+t-6]=N,s[r*a+t-5]=N,o[i=r*a+t-4]!==A&&(o[i]=F,s[i]=N),o[i=r*a+t-3]!==A&&(o[i]=F,s[i]=N),o[i=r*a+t-2]!==A&&(o[i]=F,s[i]=N),o[i=r*a+t-1]!==A&&(o[i]=F,s[i]=N),o[i=r*a+t]!==A&&(o[i]=F,s[i]=N),o[i=r*a+t+1]!==A&&(o[i]=F,s[i]=N),o[i=r*a+t+2]!==A&&(o[i]=F,s[i]=N),o[i=r*a+t+3]!==A&&(o[i]=F,s[i]=N),o[i=r*a+t+4]!==A&&(o[i]=F,s[i]=N),s[r*a+t+5]=N,s[r*a+t+6]=N,s[(r+1)*a+t-6]=N,s[(r+1)*a+t-5]=N,o[i=(r+1)*a+t-4]!==A&&(o[i]=F,s[i]=N),o[i=(r+1)*a+t-3]!==A&&(o[i]=F,s[i]=N),o[i=(r+1)*a+t-2]!==A&&(o[i]=F,s[i]=N),o[i=(r+1)*a+t-1]!==A&&(o[i]=F,s[i]=N),o[i=(r+1)*a+t]!==A&&(o[i]=F,s[i]=N),o[i=(r+1)*a+t+1]!==A&&(o[i]=F,s[i]=N),o[i=(r+1)*a+t+2]!==A&&(o[i]=F,s[i]=N),o[i=(r+1)*a+t+3]!==A&&(o[i]=F,s[i]=N),o[i=(r+1)*a+t+4]!==A&&(o[i]=F,s[i]=N),s[(r+1)*a+t+5]=N,s[(r+1)*a+t+6]=N,s[(r+2)*a+t-5]=N,s[(r+2)*a+t-4]=N,o[i=(r+2)*a+t-3]!==A&&(o[i]=F,s[i]=N),o[i=(r+2)*a+t-2]!==A&&(o[i]=F,s[i]=N),o[i=(r+2)*a+t-1]!==A&&(o[i]=F,s[i]=N),o[i=(r+2)*a+t]!==A&&(o[i]=F,s[i]=N),o[i=(r+2)*a+t+1]!==A&&(o[i]=F,s[i]=N),o[i=(r+2)*a+t+2]!==A&&(o[i]=F,s[i]=N),o[i=(r+2)*a+t+3]!==A&&(o[i]=F,s[i]=N),s[(r+2)*a+t+4]=N,s[(r+2)*a+t+5]=N,s[(r+3)*a+t-5]=N,s[(r+3)*a+t-4]=N,s[(r+3)*a+t-3]=N,o[i=(r+3)*a+t-2]!==A&&(o[i]=F,s[i]=N),o[i=(r+3)*a+t-1]!==A&&(o[i]=F,s[i]=N),o[i=(r+3)*a+t]!==A&&(o[i]=F,s[i]=N),o[i=(r+3)*a+t+1]!==A&&(o[i]=F,s[i]=N),o[i=(r+3)*a+t+2]!==A&&(o[i]=F,s[i]=N),s[(r+3)*a+t+3]=N,s[(r+3)*a+t+4]=N,s[(r+3)*a+t+5]=N,s[(r+4)*a+t-4]=N,s[(r+4)*a+t-3]=N,s[(r+4)*a+t-2]=N,o[i=(r+4)*a+t-1]!==A&&(o[i]=F,s[i]=N),o[i=(r+4)*a+t]!==A&&(o[i]=F,s[i]=N),o[i=(r+4)*a+t+1]!==A&&(o[i]=F,s[i]=N),s[(r+4)*a+t+2]=N,s[(r+4)*a+t+3]=N,s[(r+4)*a+t+4]=N,s[(r+5)*a+t-3]=N,s[(r+5)*a+t-2]=N,s[(r+5)*a+t-1]=N,s[(r+5)*a+t]=N,s[(r+5)*a+t+1]=N,s[(r+5)*a+t+2]=N,s[(r+5)*a+t+3]=N,s[(r+6)*a+t-1]=N,s[(r+6)*a+t]=N,s[(r+6)*a+t+1]=N;break;default:throw new Error("Unhandled width: "+n)}}function h(e,t,r,n,i,a,o,s){var u,h,f,l,c,d,p=!0,v=!1,g=s.width,m=s.height,b=s.condition,y=s.outside,x=i*g;if(0!==r[x+n])return null;if(f=i-1,l=i+1,u=n-1,h=n+1,c=0,n>0?(c|=i>0?b(t[x+n])<<3:y<<3,c|=l<m?b(t[x+g+n])<<0:y<<0):(c|=y<<3,c|=y<<0),h<g?(c|=i>0?b(t[x+h])<<2:y<<2,c|=l<m?b(t[x+g+h])<<1:y<<1):(c|=y<<2,c|=y<<1),0===c||15===c)return null;switch(c){case 1:d=[n,i+.5];break;case 2:d=[n+.5,l];break;case 3:d=[n,i+.5];break;case 4:d=[h,i+.5];break;case 5:d=p?[n,i+.5]:[h,i+.5];break;case 6:d=[n+.5,l];break;case 7:d=[n,i+.5];break;case 8:case 9:d=[n+.5,i];break;case 10:d=v?[n+.5,i]:[n+.5,l];break;case 11:d=[n+.5,i];break;case 12:case 13:d=[h,i+.5];break;case 14:d=[n+.5,l];break;default:throw new Error("Invalid cell value")}do{switch(r[x+n]=e,c){case 1:d.push(n+.5,l),i=l,p=!1,v=!0;break;case 2:case 3:d.push(h,i+.5),n=h,p=!0,v=!1;break;case 4:d.push(n+.5,i),i=f,p=!1,v=!1;break;case 5:p?(d.push(n+.5,i),i=f,v=!1):(d.push(n+.5,l),i=l,v=!0),p=!1;break;case 6:case 7:d.push(n+.5,i),i=f,p=!1,v=!1;break;case 8:d.push(n,i+.5),n=u,p=!1,v=!1;break;case 9:d.push(n+.5,l),i=l,p=!1,v=!0;break;case 10:v?(d.push(h,i+.5),n=h,p=!0):(d.push(n,i+.5),n=u,p=!1),v=!1;break;case 11:d.push(h,i+.5),n=h,p=!0,v=!1;break;case 12:d.push(n,i+.5),n=u,p=!1,v=!1;break;case 13:d.push(n+.5,l),i=l,p=!1,v=!0;break;case 14:d.push(n,i+.5),n=u,p=!1,v=!1;break;default:throw new Error("Unhandled cell value: "+JSON.stringify({cellCase:c,x:n,y:i},null,4))}x=i*g,f=i-1,l=i+1,u=n-1,h=n+1,c=0,n>0?(c|=i>0?b(t[x+n])<<3:y<<3,c|=l<m?b(t[x+g+n])<<0:y<<0):(c|=y<<3,c|=y<<0),h<g?(c|=i>0?b(t[x+h])<<2:y<<2,c|=l<m?b(t[x+g+h])<<1:y<<1):(c|=y<<2,c|=y<<1)}while(n!==a||i!==o);return d}function f(e,t,r,n,i,a){var o=i-r,s=a-n,u=Math.sqrt(o*o+s*s);u>0&&(o/=u,s/=u);var h=e-r,f=t-n,l=o*h+s*f,c=h-l*o,d=f-l*s;return Math.sqrt(c*c+d*d)}function l(e,t){var r=arguments.length>2&&void 0!==arguments[2]&&arguments[2];r&&e.push(e[0],e[1]);var n=[e[0],e[1]];return function e(t,r,n,i,a){for(var o=0,s=0,u=t[r],h=t[r+1],l=t[n],c=t[n+1],d=r+2;d<n;d+=2){var p=f(t[d],t[d+1],u,h,l,c);p>o&&(s=d,o=p)}o>i?(e(t,r,s,i,a),e(t,s,n,i,a)):a.push(l,c)}(e,0,e.length-2,t,n),r?n.slice(0,n.length-2):n}var c,d=r(3);function p(e,t){for(var r=0;r<t.length;r++){var n=t[r];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,n.key,n)}}function v(e,t){var r=Object.keys(e);return Object.getOwnPropertySymbols&&r.push.apply(r,Object.getOwnPropertySymbols(e)),t&&(r=r.filter(function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable})),r}function g(e){for(var t=1;t<arguments.length;t++){var r=null!=arguments[t]?arguments[t]:{};t%2?v(r,!0).forEach(function(t){m(e,t,r[t])}):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(r)):v(r).forEach(function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(r,t))})}return e}function m(e,t,r){return t in e?Object.defineProperty(e,t,{value:r,enumerable:!0,configurable:!0,writable:!0}):e[t]=r,e}r.d(t,"c",function(){return A}),r.d(t,"b",function(){return F}),r.d(t,"d",function(){return N}),r.d(t,"a",function(){return X}),r.d(t,"f",function(){return oe}),r.d(t,"e",function(){return he});var b=2*Math.PI,y=1.4,x=20,T=5,w=.034,k=2e3;function C(e){return e<-1?-1:e>1?1:e}var M=.05,S=.07,z=.09,I=.5,A=1,_=2,P=3,O=4,B=5,R=6,E=7,F=8,j=9,L=10,D=5,N=6,U=8,G=10,Y=11,V=15,W=17,X=18;function q(e){if(!e)return 0;for(var t=0,r=1;r<e.length;r+=2)t+=e[r];return t}var H=[0,0,.5,1,1,-2,1,1,0];var J=function(e){for(var t in e)if(e.hasOwnProperty(t)){var r=e[t];if(r)for(var n=q(r),i=1;i<r.length;i+=2)r[i]/=n}return e}((m(c={},A,[9,1]),m(c,_,[0,500,V,1,W,1,16,1]),m(c,P,[0,1e3,G,2,Y,2,12,3,14,3,V,1,W,1,16,2]),m(c,O,[0,1e3,G,2,Y,2,12,3,14,3,V,1,W,1,16,2]),m(c,B,[U,4,V,1,W,1,16,1]),m(c,R,[7,150,G,2,Y,2,12,5,13,5,14,5,2,1,3,1,4,1,V,1,W,1,16,2]),m(c,E,[7,40,G,2,Y,2,12,5,13,5,14,5,2,1,3,1,4,1,V,1,W,1,16,2]),m(c,F,[N,1]),c));function Q(e,t,r){var n=e.things,i=(e.size,e.sizeMask);if(0===n[t]){var a=J[r];if(a){var o=function(e,t){if(t.length<4)return t[0];var r=e.random.next(),n=1;do{r-=t[n],n+=2}while(r>0&&n<t.length);return t[n-3]}(e,a);if(o)if(o===G||o===Y){var s=t-2&i,u=t-1&i,h=t+1&i,f=t+2&i,l=t+3&i;n[t-3&i]!==U&&n[s]!==U&&n[u]!==U&&(n[t]=o,n[h]=U,n[f]=U,n[l]=U)}else if(o===V||o===W){var c=t+1&i;n[t-1&i]!==U&&(n[t]=o,n[c]=U)}else n[t]=o}}}var K=[0,0];function Z(e,t,r,n){var i,a=e.heightCoords(t,r),o=e.heightFn(t,r,a,K);if(n=C(n-.96*o+.2*K[1]),o<M)i=A;else if(o<S)i=_;else if(o<I){var s=a.nx,u=a.ny,h=a.nz,f=a.nw,l=o>z?e.noise4D(s*T,f*T,u*T,h*T):1,c=e.noise4D(s*x,f*x,u*x,h*x);i=l<0?c<0?R:E:c<0?P:O}else i=B;if(n<.4){if(i===A)return L;if(i===E||i===P||i===O||i===_)return j;if(i===R)return B}else if(n>.95&&(i===R||i===E||i===P||i===O))return _;return i}function $(e,t,r,n){for(var i=new he(e,t),a=i.tiles,o=0,s=e/20|0,u=b/2/e,h=0,f=0;f<e;f++){var l=Math.sin(h);h+=u;for(var c=0;c<e;c++){var d=Z(i,c,f,l);a[o]=d,Q(i,o,d),o++}r&&f%s==0&&r(n*f/e)}return i}var ee=[0,-1,-1,0,1,0,0,1];function te(e,t){for(var r=t.value,n=t.x,i=t.y,a=e.size,o=!1,s=0;s<ee.length;s+=2){var u=t.x+ee[s],h=t.y+ee[s+1];if(u>0&&h>0&&u<a&&h<a){var f=e.heightFn(u,h);f>r&&(r=f,n=u,i=h,o=!0)}}return!!o&&{x:n,y:i,value:r,points:[]}}function re(e){var t=function(e){for(var t=[],r=e.size,n=r*r/1e3,i=0;i<n;i++){var a=e.random.next()*r|0,o=e.random.next()*r|0,s=e.heightFn(a,o);s>M&&t.push({x:a,y:o,value:s,points:[],tile:0})}return t}(e),r=e.size,n=t.length,i=0,a=0;for(a=0;a<r/2&&i<n;a++)for(var o=i;o<n;o++){var s=te(e,t[o]);if(s)t[o]=s;else{var u=t[i];t[i]=t[o],t[o]=u,i++}}return function(e,t){for(var r=arguments.length>2&&void 0!==arguments[2]?arguments[2]:8,n=[],i=0;i<t.length;i++){var a=t[i],o=e.random.nextInt(-r,r),s=e.random.nextInt(-r,r);a.x=a.x+o,a.y=a.y+s,e.heightFn(a.x,a.y)>I&&e.random.next()<.6&&n.push(g({},a,{points:[],x:a.x-r-s|0,y:a.y-r+o|0}))}return t.concat(n)}(e,function(e){for(var t=e.length,r=[],n=0;n<t;n++){for(var i=e[n],a=!0,o=t-1;o>n;o--){var s=e[o];if(i.x===s.x&&i.y===s.y){a=!1;break}}a&&r.push(i)}return r}(t))}function ne(e,t){for(var r=1/0,n=t.x,i=t.y,a=-1,o=-1,s=!1,u=e.size,h=0;h<ee.length;h+=2){var f=t.x+ee[h],l=t.y+ee[h+1];if(f>0&&l>0&&f<u&&l<u){var c=e.read(f,l);if(c!==F){if(c===B){var d=e.heightCoords(f,l),p=d.nx,v=d.ny,g=d.nz,m=d.nw;c=e.noise4D(p*x,m*x,v*x,g*x)<0?P:O}var b=e.heightFn(f,l)-(c!==_&&c===t.tile?.001:0);b<r&&(r=b,n=f,i=l,a=c,o=h,s=!0)}}}if(s){var y=e.random.next();if(y<.25){var T=2*(o/2+(y<.125?-1:1)&3);t.x+=ee[T],t.y+=ee[T+1],t.points.push(t.x,t.y),t.x+=ee[T],t.y+=ee[T+1],t.value=1,t.tile=e.read(t.x,t.y)}else t.x=n,t.y=i,t.value=r,t.tile=a}else{var w=2*e.random.nextInt(0,3);t.x+=ee[w],t.y+=ee[w+1],t.tile=e.read(t.x,t.y)}}function ie(e){var t,r=re(e),n=e.size,i=r.length,a=0,o=0;for(o=0;o<n&&a<i;o++)for(var s=a;s<i;s++){var h=r[s],f=h.x,l=h.y;h.points.push(f,l);var c=e.read(h.x,h.y);if(c!==A&&c!==j&&c!==L)ne(e,h);else{var d=r[a];r[a]=r[s],r[s]=d,a++}}for(var p=0;p<r.length;p++)for(var v=r[p].points,g=0;g<v.length;g+=2){var m=(t=g,0|Math.min(8,.008*t));u(e,v[g],v[g+1],m)}return r}function ae(e,t){for(var r=function(e,t){t.sort(function(e,t){return e.points.length-t.points.length}),t.length;var r=function(e){var t=(e.length-1)/2;return t%1?e[0|t].points.length+e[1+(0|t)].points.length/2:e[0|t].points.length}(t);return t.filter(function(e){return e.points.length>2*r})}(0,t).filter(function(t,r){var n,i=t.points,a=i.length,o=a*w|0,s=i[a-2],u=i[a-1];for(n=a-4;n>0;n-=2){var h=i[n]-s,f=i[n+1]-u;if(Math.sqrt(h*h+f*f)>o)break}for(var l=function(e,t,r){for(var n,i,a=1/0,o=0;o<ee.length;o+=2){for(var s=ee[o],u=ee[o+1],h=1,f=t+s,l=r+u;e.read(f,l)===F;)h++,f+=s,l+=u;h<a&&(a=h,n=f,i=l)}return{px:n,py:i}}(e,i[n],i[n+1]),c=l.px,d=l.py,p=o*o,v=0,g=-o;g<o;g++)for(var m=0|Math.sqrt(p-g*g),b=-m;b<m;b++)v+=H[e.read(c+b,d+g)];return t.centerX=c&e.sizeMask,t.centerY=d&e.sizeMask,t.radius=o,v>k}),n=0;n<r.length;n++)for(var i=r[n],a=i.centerX,o=i.centerY,s=i.radius,u=s*s,h=-s;h<=s;h++){var f=Math.round(Math.sqrt(u-h*h));e.putThing(a+f,o+h,D),e.putThing(a-f,o+h,D)}return r}function oe(e,t,r){for(var n=r.length,i=r[n-2],a=r[n-1],o=!1,s=0;s<n;s+=2){var u=r[s],h=r[s+1];h>t!=a>t&&e<u+(i-u)*(t-h)/(a-h)&&(o=!o),i=u,a=h}return o}var se=2.5;function ue(e,t){var r=function(e,t,r,n,i){if(e.length!==t*r)throw new Error("array size does not match width*height: "+JSON.stringify({array:e.length,width:t,height:r}));for(var a=s()(),o=new Uint8Array(t*r),u=[],f={width:t,height:r,condition:n,outside:i},l=0;l<r;l++)for(var c=0;c<t;c++){var d=h(u.length+1,e,o,c,l,c,l,f);d&&d.length>6&&u.push(d)}return console.log("Marching squares done in "+(s()()-a)+"ms"),u}(e.things,e.size,e.size,function(e){return e>=U},!0);console.log("MARCHING-CUBE: polygons = ",r.length,", vertexes = ",r.reduce(function(e,t){return e+t.length},0));var n=r.map(function(e){return l(e,se,!0)}).filter(function(e){return e.length>6});console.log("SIMPLIFIED: polygons = ",n.length,", vertexes = ",n.reduce(function(e,t){return e+t.length},0));var i=function(e){for(var t=[],r=0;r<e.length;r++)t=t.concat(e[r]);return t}(n),a=d.a.triangulate(i);console.log("DELAUNAY: triangles",a.length/3,", vertexes = ",a.length);var o=function(e,t,r){return r}(0,0,a);console.log("WALKABLE: triangles",o.length/3,", vertexes = ",o.length),e.vertices=i,e.polygons=n,e.triangles=o}var he=function(){function e(){var t=this,r=arguments.length>0&&void 0!==arguments[0]?arguments[0]:800,n=arguments.length>1?arguments[1]:void 0,o=arguments.length>2?arguments[2]:void 0,s=arguments.length>3?arguments[3]:void 0;if(function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,e),Math.log(r)/Math.log(2)%1!=0)throw new Error("Size must be power of two: "+r);this.random=new a.a(n),this.noise=new i.a(function(){return t.random.next()}),this.size=r,this.sizeMask=r-1,this.fineMask=(r<<4)-1,this.factor=1/r,this.tiles=o||new Uint8Array(r*r),this.things=s||new Uint8Array(r*r)}var t,r,n;return t=e,n=[{key:"deserialize",value:function(t){var r=t.size,n=t.seed,i=t.things;return new e(r,n,t.tiles,i)}},{key:"generate",value:function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:(new Date).getTime(),r=arguments.length>2?arguments[2]:void 0,n=s()(),i=$(e,t,r,.75),a=s()(),o=ie(i),u=s()();r&&r(.87);ae(i,o);var h=s()();ue(i),r&&r(1);var f=s()();return console.log("Base in ".concat(a-n,"ms")),console.log("Rivers in ".concat(u-n,"ms")),console.log("Cities in ".concat(h-n,"ms")),console.log("Roads in ".concat(f-n,"ms")),i}}],(r=[{key:"read",value:function(e,t){return this.tiles[(t&this.sizeMask)*this.size+(e&this.sizeMask)]}},{key:"getThing",value:function(e,t){return this.things[(t&this.sizeMask)*this.size+(e&this.sizeMask)]}},{key:"write",value:function(e,t,r){this.tiles[(t&this.sizeMask)*this.size+(e&this.sizeMask)]=r}},{key:"putThing",value:function(e,t,r){this.things[(t&this.sizeMask)*this.size+(e&this.sizeMask)]=r}},{key:"heightFn",value:function(e,t,r){var n,i,a,o,s=arguments.length>3&&void 0!==arguments[3]?arguments[3]:null,u=e*this.factor,h=t*this.factor;r?(n=r.nx,i=r.ny,a=r.nz,o=r.nw):(n=Math.cos(u*b),i=Math.cos(h*b),a=Math.sin(u*b),o=Math.sin(h*b));var f=this.noise4D(.4*n,.4*i,.4*a,.4*o),l=this.noise4D(n*y,o*y,i*y,a*y);return s&&(s[0]=f,s[1]=l),C(f<0?-f*f:f*f)+.3*l}},{key:"heightCoords",value:function(e,t){var r=e*this.factor,n=t*this.factor;return{nx:Math.cos(r*b),ny:Math.cos(n*b),nz:Math.sin(r*b),nw:Math.sin(n*b)}}},{key:"render",value:function(e){for(var t=this.size,r=e.createImageData(t,t),n=r.data,i=0,a=0,o=0;o<t;o++)for(var s=0;s<t;s++){switch(this.tiles[i++]){case F:n[a++]=128,n[a++]=128,n[a++]=255,n[a++]=255;break;case A:n[a++]=0,n[a++]=32,n[a++]=128,n[a++]=255;break;case _:n[a++]=192,n[a++]=160,n[a++]=0,n[a++]=255;break;case P:n[a++]=0,n[a++]=128,n[a++]=0,n[a++]=255;break;case R:n[a++]=0,n[a++]=108,n[a++]=16,n[a++]=255;break;case E:n[a++]=0,n[a++]=64,n[a++]=32,n[a++]=255;break;case O:n[a++]=64,n[a++]=64,n[a++]=0,n[a++]=255;break;case B:n[a++]=100,n[a++]=100,n[a++]=100,n[a++]=255;break;case j:n[a++]=248,n[a++]=248,n[a++]=255,n[a++]=255;break;case L:n[a++]=220,n[a++]=220,n[a++]=255,n[a++]=255}}return r}},{key:"noise4D",value:function(e,t,r,n){return this.noise.noise4D(e,t,r,n)}},{key:"serialize",value:function(){return{_:"Map serialization",size:this.size,seed:this.random._seed,tiles:this.tiles,things:this.things}}}])&&p(t.prototype,r),n&&p(t,n),e}()},10:function(e,t,r){(function(e){!function(t){var r=function(e){this.tileAnim=[0,0],this.dontUseTransform=!1,this.renderer=e,this.tileAnim=[0,0]};t.CanvasTileRenderer=r;var n=e.CanvasRenderer;n&&n.registerPlugin("tilemap",r)}(r||(r={}));var t,r,n=this&&this.__extends||(t=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var r in t)t.hasOwnProperty(r)&&(e[r]=t[r])},function(e,r){function n(){this.constructor=e}t(e,r),e.prototype=null===r?Object.create(r):(n.prototype=r.prototype,new n)});!function(t){var r=function(r){function i(e,t,n){var i=r.call(this)||this;return i.modificationMarker=0,i.shadowColor=new Float32Array([0,0,0,.5]),i._globalMat=null,i.initialize.apply(i,arguments),i}return n(i,r),i.prototype.updateTransform=function(){this.displayObjectUpdateTransform()},i.prototype.initialize=function(e,r,n){!0===n&&(n=0),this.z=this.zIndex=e,this.texPerChild=n||t.Constant.boundCountPerBuffer*t.Constant.maxTextures,r&&this.setBitmaps(r)},i.prototype.setBitmaps=function(e){var r,n=this.texPerChild,i=this.children.length,a=Math.ceil(e.length/n);for(r=0;r<i;r++)this.children[r].TEXTURES=e.slice(r*n,(r+1)*n);for(r=i;r<a;r++){var o=new t.RectTileLayer(this.zIndex,e.slice(r*n,(r+1)*n));o.compositeParent=!0,o.offsetX=t.Constant.boundSize,o.offsetY=t.Constant.boundSize,this.addChild(o)}},i.prototype.clear=function(){for(var e=0;e<this.children.length;e++)this.children[e].clear();this.modificationMarker=0},i.prototype.addRect=function(e,t,r,n,i,a,o){var s=e/this.texPerChild>>0,u=e%this.texPerChild;this.children[s]&&this.children[s].textures&&this.children[s].addRect(u,t,r,n,i,a,o)},i.prototype.addFrame=function(r,n,i,a,o){var s,u=null,h=0,f=this.children;if("number"==typeof r){if(u=f[r/this.texPerChild>>0])h=r%this.texPerChild;else{if(!(u=f[0]))return!1;h=0}s=u.textures[h]}else{s="string"==typeof r?e.Texture.from(r):r;for(var l=0;l<f.length;l++){for(var c=(p=f[l]).textures,d=0;d<c.length;d++)if(c[d].baseTexture===s.baseTexture){u=p,h=d;break}if(u)break}if(!u){for(l=0;l<f.length;l++){var p;if((p=f[l]).textures.length<this.texPerChild){u=p,h=p.textures.length,p.textures.push(s);break}}u||((u=new t.RectTileLayer(this.zIndex,s)).compositeParent=!0,u.offsetX=t.Constant.boundSize,u.offsetY=t.Constant.boundSize,f.push(u),h=0)}}return u.addRect(h,s.frame.x,s.frame.y,n,i,s.frame.width,s.frame.height,a,o),!0},i.prototype.renderCanvas=function(e){if(this.visible&&!(this.worldAlpha<=0)&&this.renderable){if(!e.plugins.tilemap.dontUseTransform){var t=this.worldTransform;e.context.setTransform(t.a,t.b,t.c,t.d,t.tx*e.resolution,t.ty*e.resolution)}for(var r=this.children,n=0;n<r.length;n++)r[n].renderCanvasCore(e)}},i.prototype.render=function(e){if(this.visible&&!(this.worldAlpha<=0)&&this.renderable){var t=e.plugins.tilemap,r=t.getShader();e.batch.setObjectRenderer(t),this._globalMat=r.uniforms.projTransMatrix,e.globalUniforms.uniforms.projectionMatrix.copyTo(this._globalMat).append(this.worldTransform),r.uniforms.shadowColor=this.shadowColor,r.uniforms.animationFrame=t.tileAnim,e.shader.bind(r,!1);for(var n=this.children,i=0;i<n.length;i++)n[i].renderWebGLCore(e,t)}},i.prototype.isModified=function(e){var t=this.children;if(this.modificationMarker!==t.length)return!0;for(var r=0;r<t.length;r++)if(t[r].isModified(e))return!0;return!1},i.prototype.clearModify=function(){var e=this.children;this.modificationMarker=e.length;for(var t=0;t<e.length;t++)e[t].clearModify()},i}(e.Container);t.CompositeRectTileLayer=r}(r||(r={})),function(t){t.Constant={maxTextures:4,bufferSize:2048,boundSize:1024,boundCountPerBuffer:1,use32bitIndex:!1,SCALE_MODE:e.SCALE_MODES.LINEAR,DO_CLEAR:!0}}(r||(r={})),r||(r={}),function(t){function r(e){var r=t.call(this)||this;return r.zIndex=e,r}n(r,t),r.prototype.renderCanvas=function(t){var r=null;t.plugins.tilemap.dontUseTransform&&(r=this.transform.worldTransform,this.transform.worldTransform=e.Matrix.IDENTITY),t.plugins.graphics.render(this),t.plugins.tilemap.dontUseTransform&&(this.transform.worldTransform=r),t.context.globalAlpha=1},r.prototype.isModified=function(e){return!1},r.prototype.clearModify=function(){}}(e.Graphics),function(t){var r=function(r){function i(t){var n=r.call(this,t.bufferSize,t.bufferSize)||this;n.DO_CLEAR=!1,n.boundSize=0,n._clearBuffer=null,n.baseTex=null,n.boundSprites=[],n.dirties=[];var i=n.boundSprites,a=n.dirties;n.boundSize=t.boundSize;for(var o=0;o<t.boundCountPerBuffer;o++){var s=new e.Sprite;s.position.x=t.boundSize*(1&o),s.position.y=t.boundSize*(o>>1),i.push(s),a.push(0)}return n.DO_CLEAR=!!t.DO_CLEAR,n}return n(i,r),i.prototype.bind=function(e){if(this.baseTex)throw new Error("Only one baseTexture is allowed for this resource!");this.baseTex=e,r.prototype.bind.call(this,e)},i.prototype.setTexture=function(e,t){var r=this.boundSprites[e];r.texture.baseTexture!==t.baseTexture&&(r.texture=t,this.baseTex.update(),this.dirties[e]=this.baseTex.dirtyId)},i.prototype.upload=function(e,r,n){var i=e.gl,a=this.width,o=this.height;i.pixelStorei(i.UNPACK_PREMULTIPLY_ALPHA_WEBGL,r.premultiplyAlpha),n.dirtyId<0&&(n.width=a,n.height=o,i.texImage2D(r.target,0,r.format,a,o,0,r.format,r.type,null));var s=this.DO_CLEAR;s&&!this._clearBuffer&&(this._clearBuffer=new Uint8Array(t.Constant.boundSize*t.Constant.boundSize*4));for(var u=this.boundSprites,h=0;h<u.length;h++){var f=u[h],l=f.texture.baseTexture;if(!(n.dirtyId>=this.dirties[h])){var c=l.resource;l.valid&&c&&c.source&&(s&&(l.width<this.boundSize||l.height<this.boundSize)&&i.texSubImage2D(r.target,0,f.position.x,f.position.y,this.boundSize,this.boundSize,r.format,r.type,this._clearBuffer),i.texSubImage2D(r.target,0,f.position.x,f.position.y,r.format,r.type,c.source))}}return!0},i}(e.resources.Resource);t.MultiTextureResource=r}(r||(r={})),function(t){var r=function(r){function i(e,t){var n=r.call(this)||this;return n.zIndex=0,n.modificationMarker=0,n.shadowColor=new Float32Array([0,0,0,.5]),n._globalMat=null,n.pointsBuf=[],n.hasAnim=!1,n.offsetX=0,n.offsetY=0,n.compositeParent=!1,n.vbId=0,n.vb=null,n.vbBuffer=null,n.vbArray=null,n.vbInts=null,n.initialize(e,t),n}return n(i,r),i.prototype.initialize=function(e,t){t?t instanceof Array||!t.baseTexture||(t=[t]):t=[],this.textures=t,this.zIndex=e},i.prototype.clear=function(){this.pointsBuf.length=0,this.modificationMarker=0,this.hasAnim=!1},i.prototype.addFrame=function(t,r,n,i,a){var o,s=0;if("number"==typeof t)s=t,o=this.textures[s];else{o="string"==typeof t?e.Texture.from(t):t;for(var u=!1,h=this.textures,f=0;f<h.length;f++)if(h[f].baseTexture===o.baseTexture){s=f,u=!0;break}if(!u)return!1}return this.addRect(s,o.frame.x,o.frame.y,r,n,o.frame.width,o.frame.height,i,a),!0},i.prototype.addRect=function(e,t,r,n,i,a,o,s,u){void 0===s&&(s=0),void 0===u&&(u=0);var h=this.pointsBuf;if(this.hasAnim=this.hasAnim||s>0||u>0,a===o)h.push(t),h.push(r),h.push(n),h.push(i),h.push(a),h.push(o),h.push(0|s),h.push(0|u),h.push(e);else{var f=void 0;if(a%o==0)for(f=0;f<a/o;f++)h.push(t+f*o),h.push(r),h.push(n+f*o),h.push(i),h.push(o),h.push(o),h.push(0|s),h.push(0|u),h.push(e);else if(o%a==0)for(f=0;f<o/a;f++)h.push(t),h.push(r+f*a),h.push(n),h.push(i+f*a),h.push(a),h.push(a),h.push(0|s),h.push(0|u),h.push(e);else h.push(t),h.push(r),h.push(n),h.push(i),h.push(a),h.push(o),h.push(0|s),h.push(0|u),h.push(e)}},i.prototype.renderCanvas=function(e){if(!e.plugins.tilemap.dontUseTransform){var t=this.worldTransform;e.context.setTransform(t.a,t.b,t.c,t.d,t.tx*e.resolution,t.ty*e.resolution)}this.renderCanvasCore(e)},i.prototype.renderCanvasCore=function(e){if(0!==this.textures.length){var t=this.pointsBuf;e.context.fillStyle="#000000";for(var r=0,n=t.length;r<n;r+=9){var i=t[r],a=t[r+1],o=t[r+2],s=t[r+3],u=t[r+4],h=t[r+5];i+=t[r+6]*e.plugins.tilemap.tileAnim[0],a+=t[r+7]*e.plugins.tilemap.tileAnim[1];var f=t[r+8];f>=0?e.context.drawImage(this.textures[f].baseTexture.source,i,a,u,h,o,s,u,h):(e.context.globalAlpha=.5,e.context.fillRect(o,s,u,h),e.context.globalAlpha=1)}}},i.prototype.destroyVb=function(){this.vb&&(this.vb.destroy(),this.vb=null)},i.prototype.render=function(e){var t=e.plugins.tilemap,r=t.getShader();e.batch.setObjectRenderer(t),this._globalMat=r.uniforms.projTransMatrix,e.globalUniforms.uniforms.projectionMatrix.copyTo(this._globalMat).append(this.worldTransform),r.uniforms.shadowColor=this.shadowColor,r.uniforms.animationFrame=t.tileAnim,e.shader.bind(r,!1),this.renderWebGLCore(e,t)},i.prototype.renderWebGLCore=function(r,n){var i=this.pointsBuf;if(0!==i.length){var a=i.length/9,o=n.getShader(),s=this.textures;if(0!==s.length){n.bindTextures(r,o,s);var u=this.vb;u||(u=n.createVb(),this.vb=u,this.vbId=u.id,this.vbBuffer=null,this.modificationMarker=0),n.checkIndexBuffer(a,u);var h=t.Constant.boundCountPerBuffer,f=u.getBuffer("aVertexPosition"),l=a*u.vertPerQuad;if(0!==l){if(this.modificationMarker!==l){this.modificationMarker=l;var c=u.stride*l;if(!this.vbBuffer||this.vbBuffer.byteLength<c){for(var d=u.stride;d<c;)d*=2;this.vbBuffer=new ArrayBuffer(d),this.vbArray=new Float32Array(this.vbBuffer),this.vbInts=new Uint32Array(this.vbBuffer),f.update(this.vbBuffer)}for(var p=this.vbArray,v=(this.vbInts,0),g=0,m=this.offsetX,b=this.offsetY,y=0;y<i.length;y+=9){this.compositeParent&&(h>1?(g=i[y+8]>>2,m=this.offsetX*(1&i[y+8]),b=this.offsetY*(i[y+8]>>1&1)):(g=i[y+8],m=0,b=0));var x=i[y+2],T=i[y+3],w=i[y+4],k=i[y+5],C=i[y]+m,M=i[y+1]+b,S=i[y+6],z=i[y+7];p[v++]=x,p[v++]=T,p[v++]=C,p[v++]=M,p[v++]=C+.5,p[v++]=M+.5,p[v++]=C+w-.5,p[v++]=M+k-.5,p[v++]=S,p[v++]=z,p[v++]=g,p[v++]=x+w,p[v++]=T,p[v++]=C+w,p[v++]=M,p[v++]=C+.5,p[v++]=M+.5,p[v++]=C+w-.5,p[v++]=M+k-.5,p[v++]=S,p[v++]=z,p[v++]=g,p[v++]=x+w,p[v++]=T+k,p[v++]=C+w,p[v++]=M+k,p[v++]=C+.5,p[v++]=M+.5,p[v++]=C+w-.5,p[v++]=M+k-.5,p[v++]=S,p[v++]=z,p[v++]=g,p[v++]=x,p[v++]=T+k,p[v++]=C,p[v++]=M+k,p[v++]=C+.5,p[v++]=M+.5,p[v++]=C+w-.5,p[v++]=M+k-.5,p[v++]=S,p[v++]=z,p[v++]=g}f.update(p)}r.geometry.bind(u,o),r.geometry.draw(e.DRAW_MODES.TRIANGLES,6*a,0)}}}},i.prototype.isModified=function(e){return!!(this.modificationMarker!==this.pointsBuf.length||e&&this.hasAnim)},i.prototype.clearModify=function(){this.modificationMarker=this.pointsBuf.length},i.prototype.destroy=function(e){r.prototype.destroy.call(this,e),this.destroyVb()},i}(e.Container);t.RectTileLayer=r}(r||(r={})),function(t){var r="\nvarying vec2 vTextureCoord;\nvarying vec4 vFrame;\nvarying float vTextureId;\nuniform vec4 shadowColor;\nuniform sampler2D uSamplers[%count%];\nuniform vec2 uSamplerSize[%count%];\n\nvoid main(void){\n   vec2 textureCoord = clamp(vTextureCoord, vFrame.xy, vFrame.zw);\n   float textureId = floor(vTextureId + 0.5);\n\n   vec4 color;\n   %forloop%\n   gl_FragColor = color;\n}\n",i="\nattribute vec2 aVertexPosition;\nattribute vec2 aTextureCoord;\nattribute vec4 aFrame;\nattribute vec2 aAnim;\nattribute float aTextureId;\n\nuniform mat3 projTransMatrix;\nuniform vec2 animationFrame;\n\nvarying vec2 vTextureCoord;\nvarying float vTextureId;\nvarying vec4 vFrame;\n\nvoid main(void){\n   gl_Position = vec4((projTransMatrix * vec3(aVertexPosition, 1.0)).xy, 0.0, 1.0);\n   vec2 anim = aAnim * animationFrame;\n   vTextureCoord = aTextureCoord + anim;\n   vFrame = aFrame + vec4(anim, anim);\n   vTextureId = aTextureId;\n}\n",a=function(r){function i(n,i,a){var o=r.call(this,new e.Program(i,a),{animationFrame:new Float32Array(2),uSamplers:[],uSamplerSize:[],projTransMatrix:new e.Matrix})||this;return o.maxTextures=0,o.maxTextures=n,t.shaderGenerator.fillSamplers(o,o.maxTextures),o}return n(i,r),i}(e.Shader);t.TilemapShader=a;var o=function(e){function a(n){var a=e.call(this,n,i,t.shaderGenerator.generateFragmentSrc(n,r))||this;return t.shaderGenerator.fillSamplers(a,a.maxTextures),a}return n(a,e),a}(a);t.RectTileShader=o;var s=function(t){function r(){var r=t.call(this)||this;r.vertSize=11,r.vertPerQuad=4,r.stride=4*r.vertSize,r.lastTimeAccess=0;var n=r.buf=new e.Buffer(new Float32Array(2),!0,!1);return r.addAttribute("aVertexPosition",n,0,!1,0,r.stride,0).addAttribute("aTextureCoord",n,0,!1,0,r.stride,8).addAttribute("aFrame",n,0,!1,0,r.stride,16).addAttribute("aAnim",n,0,!1,0,r.stride,32).addAttribute("aTextureId",n,0,!1,0,r.stride,40),r}return n(r,t),r}(e.Geometry);t.RectTileGeom=s}(r||(r={})),function(t){var r=function(r){function i(n){var i=r.call(this,n)||this;return i.sn=-1,i.indexBuffer=null,i.ibLen=0,i.tileAnim=[0,0],i.texLoc=[],i.texResources=[],i.rectShader=new t.RectTileShader(t.Constant.maxTextures),i.indexBuffer=new e.Buffer(void 0,!0,!0),i.checkIndexBuffer(2e3),i.initBounds(),i}return n(i,r),i.prototype.initBounds=function(){if(!(t.Constant.boundCountPerBuffer<=1))for(var r=t.Constant.maxTextures,n=0;n<r;n++){var i=new t.MultiTextureResource(t.Constant),a=new e.BaseTexture(i);a.scaleMode=t.Constant.SCALE_MODE,a.wrapMode=e.WRAP_MODES.CLAMP,this.texResources.push(i)}},i.prototype.bindTexturesWithoutRT=function(e,t,r){var n=t.uniforms.uSamplerSize;this.texLoc.length=0;for(var i=0;i<r.length;i++){var a=r[i];if(!a||!a.valid)return;e.texture.bind(r[i],i),n[2*i]=1/r[i].baseTexture.width,n[2*i+1]=1/r[i].baseTexture.height}t.uniforms.uSamplerSize=n},i.prototype.bindTextures=function(e,r,n){var i=n.length,a=t.Constant.maxTextures;if(!(i>t.Constant.boundCountPerBuffer*a))if(t.Constant.boundCountPerBuffer<=1)this.bindTexturesWithoutRT(e,r,n);else{for(var o=0;o<i;o++){var s=n[o];if(s&&s.valid)this.texResources[o>>2].setTexture(3&o,s)}var u=o+3>>2;for(o=0;o<u;o++)e.texture.bind(this.texResources[o].baseTex,o)}},i.prototype.start=function(){},i.prototype.createVb=function(){var e=new t.RectTileGeom;return e.addIndex(this.indexBuffer),e.lastTimeAccess=Date.now(),e},i.prototype.checkIndexBuffer=function(r,n){void 0===n&&(n=null);var i=6*r;if(!(i<=this.ibLen)){for(var a=i;a<i;)a<<=1;this.ibLen=i,this.indexBuffer.update(e.utils.createIndicesForQuads(r,t.Constant.use32bitIndex))}},i.prototype.getShader=function(){return this.rectShader},i.prototype.destroy=function(){r.prototype.destroy.call(this),this.rectShader=null},i}(e.ObjectRenderer);t.TileRenderer=r,e.Renderer.registerPlugin("tilemap",r)}(r||(r={})),function(t){var r=function(t){function r(e,r){var n=t.call(this)||this;return n._lastAnimationFrame=-1,n.tilemap=e,n.z=r,n}return n(r,t),r.prototype.clear=function(){for(var e=this.children,t=0;t<e.length;t++)e[t].clear();this._previousLayers=0},r.prototype.cacheIfDirty=function(){var t=this.tilemap,r=this.children,n=this._previousLayers!==r.length;this._previousLayers=r.length;var i,a=this.canvasBuffer,o=this._tempRender;if(a||(a=this.canvasBuffer=document.createElement("canvas"),(o=this._tempRender=new e.CanvasRenderer(100,100,{view:a})).context=o.rootContext,o.plugins.tilemap.dontUseTransform=!0),a.width===t._layerWidth&&a.height===t._layerHeight||(a.width=t._layerWidth,a.height=t._layerHeight,n=!0),!n)for(i=0;i<r.length;i++)if(r[i].isModified(this._lastAnimationFrame!==t.animationFrame)){n=!0;break}if(this._lastAnimationFrame=t.animationFrame,n)for(t._hackRenderer&&t._hackRenderer(o),o.context.clearRect(0,0,a.width,a.height),i=0;i<r.length;i++)r[i].clearModify(),r[i].renderCanvas(o);for(this.layerTransform=this.worldTransform,i=0;i<r.length;i++){this.layerTransform=r[i].worldTransform;break}},r.prototype.renderCanvas=function(e){this.cacheIfDirty();var t=this.layerTransform;e.context.setTransform(t.a,t.b,t.c,t.d,t.tx*e.resolution,t.ty*e.resolution);this.tilemap;e.context.drawImage(this.canvasBuffer,0,0)},r}(e.Container);t.ZLayer=r}(r||(r={})),function(t){e.tilemap=t}(r||(r={})),function(e){!function(t){t.fillSamplers=function(t,r){for(var n=[],i=0;i<r;i++)n[i]=i;t.uniforms.uSamplers=n;var a=[];for(i=0;i<r;i++)a.push(1/e.Constant.bufferSize),a.push(1/e.Constant.bufferSize);t.uniforms.uSamplerSize=a},t.generateFragmentSrc=function(e,t){return t.replace(/%count%/gi,e+"").replace(/%forloop%/gi,this.generateSampleSrc(e))},t.generateSampleSrc=function(e){var t="";t+="\n",t+="\n",t+="if(vTextureId <= -1.0) {",t+="\n\tcolor = shadowColor;",t+="\n}";for(var r=0;r<e;r++)t+="\nelse ",r<e-1&&(t+="if(textureId == "+r+".0)"),t+="\n{",t+="\n\tcolor = texture2D(uSamplers["+r+"], textureCoord * uSamplerSize["+r+"]);",t+="\n}";return t+="\n",t+="\n"}}(e.shaderGenerator||(e.shaderGenerator={}))}(r||(r={}))}).call(this,r(4))},3:function(e,t,r){"use strict";var n=1/1048576;function i(e,t,r,i){var a,o,s,u,h,f,l,c,d,p,v=e[2*t],g=e[2*t+1],m=e[2*r],b=e[2*r+1],y=e[2*i],x=e[2*i+1],T=Math.abs(g-b),w=Math.abs(b-x);if(T<n&&w<n)throw new Error("Eek! Coincident points!");return T<n?o=(u=-(y-m)/(x-b))*((a=(m+v)/2)-(f=(m+y)/2))+(c=(b+x)/2):w<n?o=(s=-(m-v)/(b-g))*((a=(y+m)/2)-(h=(v+m)/2))+(l=(g+b)/2):(a=((s=-(m-v)/(b-g))*(h=(v+m)/2)-(u=-(y-m)/(x-b))*(f=(m+y)/2)+(c=(b+x)/2)-(l=(g+b)/2))/(s-u),o=T>w?s*(a-h)+l:u*(a-f)+c),{i:t,j:r,k:i,x:a,y:o,r:(d=m-a)*d+(p=b-o)*p}}function a(e){var t,r,n,i,a,o;for(r=e.length;r;)for(i=e[--r],n=e[--r],t=r;t;)if(o=e[--t],n===(a=e[--t])&&i===o||n===o&&i===a){e.splice(r,2),e.splice(t,2);break}}var o={triangulate:function(e){var t,r,o,s,u,h,f,l,c,d,p,v,g=e.length/2;if(g<3)return[];for(e=e.slice(0),o=new Array(g),t=g;t--;)o[t]=t;for(o.sort(function(t,r){var n=e[2*r]-e[2*t];return 0!==n?n:t-r}),s=function(e){var t,r,n,i,a,o,s=Number.POSITIVE_INFINITY,u=Number.POSITIVE_INFINITY,h=Number.NEGATIVE_INFINITY,f=Number.NEGATIVE_INFINITY;for(t=e.length;t--;)e[2*t]<s&&(s=e[2*t]),e[2*t]>h&&(h=e[2*t]),e[2*t+1]<u&&(u=e[2*t+1]),e[2*t+1]>f&&(f=e[2*t+1]);return n=f-u,[(a=s+.5*(r=h-s))-20*(i=Math.max(r,n)),(o=u+.5*n)-i,a,o+20*i,a+20*i,o-i]}(e),u=[i(e=e.concat(s),g+0,g+1,g+2)],h=[],f=[],t=o.length;t--;f.length=0){for(v=o[t],r=u.length;r--;)(l=e[2*v]-u[r].x)>0&&l*l>u[r].r?(h.push(u[r]),u.splice(r,1)):l*l+(c=e[2*v+1]-u[r].y)*c-u[r].r>n||(f.push(u[r].i,u[r].j,u[r].j,u[r].k,u[r].k,u[r].i),u.splice(r,1));for(a(f),r=f.length;r;)p=f[--r],d=f[--r],u.push(i(e,d,p,v))}for(t=u.length;t--;)h.push(u[t]);for(u.length=0,t=h.length;t--;)h[t].i<g&&h[t].j<g&&h[t].k<g&&u.push(h[t].i,h[t].j,h[t].k);for(var m=0;m<u.length;m++)u[m]*=2;return u},contains:function(e,t,r,n,i,a,o){if(i<e[t]&&i<e[r]&&i<e[n]||i>e[t]&&i>e[r]&&i>e[n]||a<e[t+1]&&a<e[r+1]&&a<e[n+1]||a>e[t+1]&&a>e[r+1]&&a>e[n+1])o.isNull=!0;else{var s=e[r]-e[t],u=e[n]-e[t],h=e[r+1]-e[t+1],f=e[n+1]-e[t+1],l=s*f-u*h;if(0===l)return null;var c=(f*(i-e[t])-u*(a-e[t+1]))/l,d=(s*(a-e[t+1])-h*(i-e[t]))/l;c<0||d<0||c+d>1?o.isNull=!0:(o.u=c,o.v=d,o.isNull=!1)}}};t.a=o},33:function(e,t,r){"use strict";r.r(t);r(10),r(34);var n,i=r(1),a=0,o=0;window.onload=function(){var e=document.createElement("canvas");e.width=2048,e.height=2048,document.getElementById("root").appendChild(e);var t=e.getContext("2d"),r=i.e.generate(2048,"floppy-disk"),s=r.render(t);function u(e){t.beginPath(),t.moveTo(e[0],e[1]);for(var r=2;r<e.length;r+=2)t.lineTo(e[r],e[r+1]);t.stroke()}function h(){for(var e=r.polygons,n=[],s=[],h=0;h<e.length;h++){var f=e[h];Object(i.f)(a,o,f)?n.push(f):s.push(f)}var l=n.length,c=s.length;t.strokeStyle="#000";for(var d=0;d<c;d++)u(s[d]);t.strokeStyle="#f0f";for(var p=0;p<l;p++)u(n[p])}function f(){n=null,h()}t.putImageData(s,0,0),h(),e.addEventListener("mousemove",function(e){a=e.clientX,o=e.clientY,n&&clearTimeout(n),n=setTimeout(f,10)},!0),console.log("ready")}},34:function(e,t,r){}});
//# sourceMappingURL=bundle-height-bc79ed22248b4cb4da7b.js.map